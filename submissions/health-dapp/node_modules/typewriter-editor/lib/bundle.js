/*! For license information please see bundle.js.LICENSE.txt */
var typewriter;(()=>{var e={529:e=>{var t=-1;function n(e,c,l,a){if(e===c)return e?[[0,e]]:[];if(null!=l){var u=function(e,t,n){var r="number"==typeof n?{index:n,length:0}:n.oldRange,o="number"==typeof n?null:n.newRange,i=e.length,s=t.length;if(0===r.length&&(null===o||0===o.length)){var c=r.index,l=e.slice(0,c),a=e.slice(c),u=o?o.index:null,d=c+s-i;if((null===u||u===d)&&!(d<0||d>s)){var f=t.slice(0,d);if((m=t.slice(d))===a){var p=Math.min(c,d);if((b=l.slice(0,p))===(L=f.slice(0,p)))return h(b,l.slice(p),f.slice(p),a)}}if(null===u||u===c){var g=c,m=(f=t.slice(0,g),t.slice(g));if(f===l){var y=Math.min(i-g,s-g);if((v=a.slice(a.length-y))===(E=m.slice(m.length-y)))return h(l,a.slice(0,a.length-y),m.slice(0,m.length-y),v)}}}if(r.length>0&&o&&0===o.length){var b=e.slice(0,r.index),v=e.slice(r.index+r.length);if(!(s<(p=b.length)+(y=v.length))){var L=t.slice(0,p),E=t.slice(s-y);if(b===L&&v===E)return h(b,e.slice(p,i-y),t.slice(p,s-y),v)}}return null}(e,c,l);if(u)return u}var d=o(e,c),f=e.substring(0,d);d=i(e=e.substring(d),c=c.substring(d));var p=e.substring(e.length-d),g=function(e,s){var c;if(!e)return[[1,s]];if(!s)return[[t,e]];var l=e.length>s.length?e:s,a=e.length>s.length?s:e,u=l.indexOf(a);if(-1!==u)return c=[[1,l.substring(0,u)],[0,a],[1,l.substring(u+a.length)]],e.length>s.length&&(c[0][0]=c[2][0]=t),c;if(1===a.length)return[[t,e],[1,s]];var h=function(e,t){var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(n.length<4||2*r.length<n.length)return null;function s(e,t,n){for(var r,s,c,l,a=e.substring(n,n+Math.floor(e.length/4)),u=-1,h="";-1!==(u=t.indexOf(a,u+1));){var d=o(e.substring(n),t.substring(u)),f=i(e.substring(0,n),t.substring(0,u));h.length<f+d&&(h=t.substring(u-f,u)+t.substring(u,u+d),r=e.substring(0,n-f),s=e.substring(n+d),c=t.substring(0,u-f),l=t.substring(u+d))}return 2*h.length>=e.length?[r,s,c,l,h]:null}var c,l,a,u,h,d=s(n,r,Math.ceil(n.length/4)),f=s(n,r,Math.ceil(n.length/2));return d||f?(c=f?d&&d[4].length>f[4].length?d:f:d,e.length>t.length?(l=c[0],a=c[1],u=c[2],h=c[3]):(u=c[0],h=c[1],l=c[2],a=c[3]),[l,a,u,h,c[4]]):null}(e,s);if(h){var d=h[0],f=h[1],p=h[2],g=h[3],m=h[4],y=n(d,p),b=n(f,g);return y.concat([[0,m]],b)}return function(e,n){for(var o=e.length,i=n.length,s=Math.ceil((o+i)/2),c=s,l=2*s,a=new Array(l),u=new Array(l),h=0;h<l;h++)a[h]=-1,u[h]=-1;a[c+1]=0,u[c+1]=0;for(var d=o-i,f=d%2!=0,p=0,g=0,m=0,y=0,b=0;b<s;b++){for(var v=-b+p;v<=b-g;v+=2){for(var L=c+v,E=(A=v===-b||v!==b&&a[L-1]<a[L+1]?a[L+1]:a[L-1]+1)-v;A<o&&E<i&&e.charAt(A)===n.charAt(E);)A++,E++;if(a[L]=A,A>o)g+=2;else if(E>i)p+=2;else if(f&&(k=c+d-v)>=0&&k<l&&-1!==u[k]&&A>=(x=o-u[k]))return r(e,n,A,E)}for(var w=-b+m;w<=b-y;w+=2){for(var x,k=c+w,N=(x=w===-b||w!==b&&u[k-1]<u[k+1]?u[k+1]:u[k-1]+1)-w;x<o&&N<i&&e.charAt(o-x-1)===n.charAt(i-N-1);)x++,N++;if(u[k]=x,x>o)y+=2;else if(N>i)m+=2;else if(!f){var A;if((L=c+d-w)>=0&&L<l&&-1!==a[L])if(E=c+(A=a[L])-L,A>=(x=o-x))return r(e,n,A,E)}}}return[[t,e],[1,n]]}(e,s)}(e=e.substring(0,e.length-d),c=c.substring(0,c.length-d));return f&&g.unshift([0,f]),p&&g.push([0,p]),s(g,a),g}function r(e,t,r,o){var i=e.substring(0,r),s=t.substring(0,o),c=e.substring(r),l=t.substring(o),a=n(i,s),u=n(c,l);return a.concat(u)}function o(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),o=r,i=0;n<o;)e.substring(i,o)==t.substring(i,o)?i=n=o:r=o,o=Math.floor((r-n)/2+n);return c(e.charCodeAt(o-1))&&o--,o}function i(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var n=0,r=Math.min(e.length,t.length),o=r,i=0;n<o;)e.substring(e.length-o,e.length-i)==t.substring(t.length-o,t.length-i)?i=n=o:r=o,o=Math.floor((r-n)/2+n);return l(e.charCodeAt(e.length-o))&&o--,o}function s(e,n){e.push([0,""]);for(var r,c=0,l=0,h=0,d="",f="";c<e.length;)if(c<e.length-1&&!e[c][1])e.splice(c,1);else switch(e[c][0]){case 1:h++,f+=e[c][1],c++;break;case t:l++,d+=e[c][1],c++;break;case 0:var p=c-h-l-1;if(n){if(p>=0&&u(e[p][1])){var g=e[p][1].slice(-1);if(e[p][1]=e[p][1].slice(0,-1),d=g+d,f=g+f,!e[p][1]){e.splice(p,1),c--;var m=p-1;e[m]&&1===e[m][0]&&(h++,f=e[m][1]+f,m--),e[m]&&e[m][0]===t&&(l++,d=e[m][1]+d,m--),p=m}}a(e[c][1])&&(g=e[c][1].charAt(0),e[c][1]=e[c][1].slice(1),d+=g,f+=g)}if(c<e.length-1&&!e[c][1]){e.splice(c,1);break}if(d.length>0||f.length>0){d.length>0&&f.length>0&&(0!==(r=o(f,d))&&(p>=0?e[p][1]+=f.substring(0,r):(e.splice(0,0,[0,f.substring(0,r)]),c++),f=f.substring(r),d=d.substring(r)),0!==(r=i(f,d))&&(e[c][1]=f.substring(f.length-r)+e[c][1],f=f.substring(0,f.length-r),d=d.substring(0,d.length-r)));var y=h+l;0===d.length&&0===f.length?(e.splice(c-y,y),c-=y):0===d.length?(e.splice(c-y,y,[1,f]),c=c-y+1):0===f.length?(e.splice(c-y,y,[t,d]),c=c-y+1):(e.splice(c-y,y,[t,d],[1,f]),c=c-y+2)}0!==c&&0===e[c-1][0]?(e[c-1][1]+=e[c][1],e.splice(c,1)):c++,h=0,l=0,d="",f=""}""===e[e.length-1][1]&&e.pop();var b=!1;for(c=1;c<e.length-1;)0===e[c-1][0]&&0===e[c+1][0]&&(e[c][1].substring(e[c][1].length-e[c-1][1].length)===e[c-1][1]?(e[c][1]=e[c-1][1]+e[c][1].substring(0,e[c][1].length-e[c-1][1].length),e[c+1][1]=e[c-1][1]+e[c+1][1],e.splice(c-1,1),b=!0):e[c][1].substring(0,e[c+1][1].length)==e[c+1][1]&&(e[c-1][1]+=e[c+1][1],e[c][1]=e[c][1].substring(e[c+1][1].length)+e[c+1][1],e.splice(c+1,1),b=!0)),c++;b&&s(e,n)}function c(e){return e>=55296&&e<=56319}function l(e){return e>=56320&&e<=57343}function a(e){return l(e.charCodeAt(0))}function u(e){return c(e.charCodeAt(e.length-1))}function h(e,n,r,o){return u(e)||a(o)?null:function(e){for(var t=[],n=0;n<e.length;n++)e[n][1].length>0&&t.push(e[n]);return t}([[0,e],[t,n],[1,r],[0,o]])}function d(e,t,r){return n(e,t,r,!0)}d.INSERT=1,d.DELETE=t,d.EQUAL=0,e.exports=d}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";function e(t){if(!t)return t;if("function"==typeof t.toJSON&&(t=t.toJSON()),Array.isArray(t))return t.map(e);if("object"==typeof t){const n={};return Object.keys(t).forEach((r=>n[r]=e(t[r]))),n}return t}function t(e,t){const n={};return Object.keys(e).forEach((r=>{e[r]===t[r]&&(n[r]=e[r])})),n}n.r(r),n.d(r,{AttributeMap:()=>m,BLOCK_ELEMENTS:()=>Ye,DecorateEvent:()=>Le,Decorator:()=>we,Delta:()=>w,Editor:()=>Kn,EditorChangeEvent:()=>qn,EditorFormatEvent:()=>Wn,EventDispatcher:()=>h,Line:()=>F,LineIterator:()=>D,LineOp:()=>O,LineOpIterator:()=>S,Op:()=>b,OpIterator:()=>v,PasteEvent:()=>Zt,React:()=>ie,ShortcutEvent:()=>Pt,Source:()=>Mt,TextChange:()=>C,TextDocument:()=>P,Types:()=>me,Typeset:()=>de,activeStore:()=>On,addShortcutsToEvent:()=>zt,cleanText:()=>dt,cloneDeep:()=>e,combineLines:()=>qe,copy:()=>Yt,decorations:()=>Ee,defaultModules:()=>pn,defaultTypes:()=>jn,deltaFromDom:()=>ft,deltaFromHTML:()=>at,deltaToText:()=>k,diff:()=>l(),docFromDom:()=>ut,docFromHTML:()=>lt,docStore:()=>Sn,docToHTML:()=>st,editorStores:()=>Mn,embed:()=>ge,focusStore:()=>Cn,format:()=>pe,fromNode:()=>ht,getBoudingBrowserRange:()=>Lt,getBrowserRange:()=>vt,getChangedRanges:()=>We,getIndexFromNode:()=>wt,getIndexFromNodeAndOffset:()=>Et,getIndexFromPoint:()=>yt,getLineElementAt:()=>xt,getLineInfoFromPoint:()=>bt,getLineNodeEnd:()=>_e,getLineNodeStart:()=>Se,getNodeAndOffset:()=>At,getNodeLength:()=>kt,getNodesForRange:()=>Nt,getSelection:()=>Ft,h:()=>oe,history:()=>Ot,inlineToHTML:()=>ct,input:()=>It,intersect:()=>t,isBRPlaceholder:()=>it,isEqual:()=>i,keyboard:()=>Vt,line:()=>fe,normalizeRange:()=>x,options:()=>W,paste:()=>Ut,patch:()=>se,placeholder:()=>tn,proxy:()=>Rn,recycleNode:()=>re,render:()=>Ie,renderChanges:()=>Re,renderCombined:()=>Be,renderDoc:()=>je,renderInline:()=>Ke,renderLine:()=>$e,renderMultiLine:()=>ze,renderSingleLine:()=>Pe,rendering:()=>Gt,rootStore:()=>In,selection:()=>en,selectionStore:()=>_n,setLineNodesRanges:()=>Ce,setSelection:()=>Dt,shortcutFromEvent:()=>qt,smartEntry:()=>hn,smartQuotes:()=>sn,textNodeLength:()=>Tt,undoStack:()=>St});const o={};function i(e,t,n=o){if(e===t)return!0;const r=typeof e,c=typeof e;if("number"===r&&"number"===c&&isNaN(e)&&isNaN(t))return!0;if(!e||!t||"object"!==r||"object"!==c||e.constructor!==t.constructor)return!1;if(e.valueOf()!==e)return i(e.valueOf(),t.valueOf(),n);const l=n.shallow?s:i;if("function"==typeof e[Symbol.iterator]){const r=e[Symbol.iterator](),o=t[Symbol.iterator]();let i=r.next(),s=o.next();for(;!i.done&&!s.done;){if(!l(i.value,s.value,n))return!1;i=r.next(),s=o.next()}return i.done===s.done}let a=Object.keys(e),u=Object.keys(t);if(n.excludeProps){const e=(h=n.excludeProps,e=>!h.has(e));a=a.filter(e),u=u.filter(e)}var h;return(n.partial||a.length===u.length)&&u.every((r=>e.hasOwnProperty(r)&&l(t[r],e[r],n)))}function s(e,t){return e===t}var c=n(529),l=n.n(c);const a=new WeakMap,u=new WeakMap;class h{on(e,t,n){this.addEventListener(e,t,n)}off(e,t,n){this.removeEventListener(e,t,n)}addEventListener(e,t,n){(null==n?void 0:n.once)&&(t=f(this,e,t,!0)),d(this,e,!0).add(t)}removeEventListener(e,t,n){if((null==n?void 0:n.once)&&(t=f(this,e,t)),!t)return;const r=d(this,e);r&&r.delete(t)}dispatchEvent(e,t){const n=d(this,e.type);if(n)for(let r of n){if(t)try{r.call(this,e)}catch(e){try{this.dispatchEvent(new ErrorEvent("error",{error:e}))}catch(e){}}else r.call(this,e);if(e.cancelBubble)break}}}function d(e,t,n=!1){let r=a.get(e);return!r&&n&&a.set(e,r=Object.create(null)),r&&r[t]||n&&(r[t]=new Set)}function f(e,t,n,r=!1){let o=u.get(e);!o&&r&&a.set(e,o=Object.create(null));const i=o&&o[t]||r&&(o[t]=new Map);if(!i.has(n)&&r){const r=r=>{const o=d(e,t);o&&o.delete(n),n.call(e,r)};i.set(n,r)}return i&&i.get(n)}var p;function g(e){return e===Object(e)&&!Array.isArray(e)}!function(t){t.compose=function t(n={},r={},o){"object"!=typeof n&&(n={}),"object"!=typeof r&&(r={});let i=e(r);for(const e in n)g(n[e])&&g(i[e])&&(i[e]=t(n[e],i[e],o));o||(i=Object.keys(i).reduce(((e,t)=>(null!=i[t]&&(e[t]=i[t]),e)),{}));for(const e in n)void 0!==n[e]&&void 0===r[e]&&(i[e]=n[e]);return Object.keys(i).length>0?i:void 0},t.diff=function e(t={},n={}){"object"!=typeof t&&(t={}),"object"!=typeof n&&(n={});const r=Object.keys(t).concat(Object.keys(n)).reduce(((r,o)=>(i(t[o],n[o])||(void 0===n[o]?r[o]=null:g(t[o])&&g(n[o])?r[o]=e(t[o],n[o]):r[o]=n[o]),r)),{});return Object.keys(r).length>0?r:void 0},t.invert=function e(t={},n={}){t=t||{};const r=Object.keys(n).reduce(((r,o)=>(i(n[o],t[o])||void 0===t[o]||(g(t[o])&&g(n[o])?r[o]=e(t[o],n[o]):r[o]=n[o]),r)),{});return Object.keys(t).reduce(((e,r)=>(t[r]!==n[r]&&void 0===n[r]&&(e[r]=null),e)),r)},t.transform=function e(t,n,r=!1){if("object"!=typeof t)return n;if("object"!=typeof n)return;if(!r)return n;const o=Object.keys(n).reduce(((r,o)=>(void 0===t[o]?r[o]=n[o]:g(t[o])&&g(n[o])&&(r[o]=e(t[o],n[o],!0)),r)),{});return Object.keys(o).length>0?o:void 0}}(p||(p={}));const m=p;var y;!function(e){e.iterator=function(e){return new v(e)},e.length=function(e){return"number"==typeof e.delete?e.delete:"number"==typeof e.retain?e.retain:"string"==typeof e.insert?e.insert.length:1}}(y||(y={}));const b=y;class v{constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return!!this.peek()}next(e){e||(e=1/0);const t=this.ops[this.index];if(t){const n=this.offset,r=y.length(t);if(e>=r-n?(e=r-n,this.index+=1,this.offset=0):this.offset+=e,"number"==typeof t.delete)return{delete:e};{if(r===e)return t;const o={};return t.attributes&&(o.attributes=t.attributes),"number"==typeof t.retain?o.retain=e:"string"==typeof t.insert?o.insert=t.insert.substr(n,e):o.insert=t.insert,o}}return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?y.length(this.ops[this.index])-this.offset:1/0}peekType(){return this.ops[this.index]?"number"==typeof this.ops[this.index].delete?"delete":"number"==typeof this.ops[this.index].retain?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(0===this.offset)return this.ops.slice(this.index);{const e=this.offset,t=this.index,n=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=t,[n].concat(r)}}return[]}}const L=String.fromCharCode(0);class E{constructor(e){Array.isArray(e)?this.ops=e:null!=e&&Array.isArray(e.ops)?this.ops=e.ops:this.ops=[]}insert(e,t){const n={};return"string"==typeof e&&0===e.length?this:(n.insert=e,null!=t&&"object"==typeof t&&Object.keys(t).length>0&&(n.attributes=t),this.push(n))}delete(e){return e<=0?this:this.push({delete:e})}retain(e,t){if(e<=0)return this;const n={retain:e};return null!=t&&"object"==typeof t&&Object.keys(t).length>0&&(n.attributes=t),this.push(n)}push(e){let t=this.ops.length,n=this.ops[t-1];if("object"==typeof n){if("number"==typeof e.delete&&"number"==typeof n.delete)return this.ops[t-1]={delete:n.delete+e.delete},this;if("number"==typeof n.delete&&null!=e.insert&&(t-=1,n=this.ops[t-1],"object"!=typeof n))return this.ops.unshift(e),this;if(i(e.attributes,n.attributes)){if("string"==typeof e.insert&&"string"==typeof n.insert)return this.ops[t-1]={insert:n.insert+e.insert},"object"==typeof e.attributes&&(this.ops[t-1].attributes=e.attributes),this;if("number"==typeof e.retain&&"number"==typeof n.retain)return this.ops[t-1]={retain:n.retain+e.retain},"object"==typeof e.attributes&&(this.ops[t-1].attributes=e.attributes),this}}return t===this.ops.length?this.ops.push(e):this.ops.splice(t,0,e),this}chop(){const e=this.ops[this.ops.length-1];return e&&e.retain&&!e.attributes&&this.ops.pop(),this}filter(e){return this.ops.filter(e)}forEach(e){this.ops.forEach(e)}map(e){return this.ops.map(e)}partition(e){const t=[],n=[];return this.forEach((r=>{(e(r)?t:n).push(r)})),[t,n]}reduce(e,t){return this.ops.reduce(e,t)}changeLength(){return this.reduce(((e,t)=>t.insert?e+b.length(t):t.delete?e-t.delete:e),0)}length(){return this.reduce(((e,t)=>e+b.length(t)),0)}slice(e=0,t=1/0){const n=[],r=b.iterator(this.ops);let o=0;for(;o<t&&r.hasNext();){let i;o<e?i=r.next(e-o):(i=r.next(t-o),n.push(i)),o+=b.length(i)}return new E(n)}compose(e,t){const n=b.iterator(this.ops),r=b.iterator(e.ops),o=[],s=r.peek();if(null!=s&&"number"==typeof s.retain&&null==s.attributes){let e=s.retain;for(;"insert"===n.peekType()&&n.peekLength()<=e;)e-=n.peekLength(),o.push(n.next());s.retain-e>0&&r.next(s.retain-e)}const c=new E(o);for(;n.hasNext()||r.hasNext();)if("insert"===r.peekType())c.push(r.next());else if("delete"===n.peekType())c.push(n.next());else{const e=Math.min(n.peekLength(),r.peekLength()),o=n.next(e),s=r.next(e);if("number"==typeof s.retain){let l;const a=s.attributes&&m.compose(o.attributes,s.attributes,!t&&"number"==typeof o.retain);if(s.attributes&&!i(a,o.attributes)?(l={},"number"==typeof o.retain?l.retain=e:l.insert=o.insert,a&&(l.attributes=a)):l=o.retain===1/0?s:o,c.push(l),s.retain===1/0||!r.hasNext()&&i(c.ops[c.ops.length-1],l)){const e=new E(n.rest());return c.concat(e).chop()}}else"number"==typeof s.delete&&"number"==typeof o.retain&&c.push(s)}return c.chop()}concat(e){const t=new E(this.ops.slice());return e.ops.length>0&&(t.push(e.ops[0]),t.ops=t.ops.concat(e.ops.slice(1))),t}diff(e,t){if(this.ops===e.ops)return new E;const n=[this,e].map((t=>t.map((n=>{if(null!=n.insert)return"string"==typeof n.insert?n.insert:L;throw new Error("diff() called "+(t===e?"on":"with")+" non-document")})).join(""))),r=new E,o=l()(n[0],n[1],t),s=b.iterator(this.ops),c=b.iterator(e.ops);return o.forEach((e=>{let t=e[1].length;for(;t>0;){let n=0;switch(e[0]){case l().INSERT:n=Math.min(c.peekLength(),t),r.push(c.next(n));break;case l().DELETE:n=Math.min(t,s.peekLength()),s.next(n),r.delete(n);break;case l().EQUAL:n=Math.min(s.peekLength(),c.peekLength(),t);const e=s.next(n),o=c.next(n);i(e.insert,o.insert)?r.retain(n,m.diff(e.attributes,o.attributes)):r.push(o).delete(n)}t-=n}})),r.chop()}eachLine(e,t="\n"){const n=b.iterator(this.ops);let r=new E,o=0;for(;n.hasNext();){if("insert"!==n.peekType())return;const i=n.peek(),s=b.length(i)-n.peekLength(),c="string"==typeof i.insert?i.insert.indexOf(t,s)-s:-1;if(c<0)r.push(n.next());else if(c>0)r.push(n.next(c));else{if(!1===e(r,n.next(1).attributes||{},o))return;o+=1,r=new E}}r.length()>0&&e(r,{},o,!0)}invert(e){const t=new E;return this.reduce(((n,r)=>{if(r.insert)t.delete(b.length(r));else{if(r.retain&&null==r.attributes)return t.retain(r.retain),n+r.retain;if(r.delete||r.retain&&r.attributes){const o=r.delete||r.retain;return e.slice(n,n+o).forEach((e=>{r.delete?t.push(e):r.retain&&r.attributes&&t.retain(b.length(e),m.invert(r.attributes,e.attributes))})),n+o}}return n}),0),t.chop()}transform(e,t=!1){if(t=!!t,"number"==typeof e)return this.transformPosition(e,t);const n=e,r=b.iterator(this.ops),o=b.iterator(n.ops),i=new E;for(;r.hasNext()||o.hasNext();)if("insert"!==r.peekType()||!t&&"insert"===o.peekType())if("insert"===o.peekType())i.push(o.next());else{const e=Math.min(r.peekLength(),o.peekLength()),n=r.next(e),s=o.next(e);if(n.delete)continue;s.delete?i.push(s):i.retain(e,m.transform(n.attributes,s.attributes,t))}else i.retain(b.length(r.next()));return i.chop()}transformPosition(e,t=!1){t=!!t;const n=b.iterator(this.ops);let r=0;for(;n.hasNext()&&r<=e;){const o=n.peekLength(),i=n.peekType();n.next(),"delete"!==i?("insert"===i&&(r<e||!t)&&(e+=o),r+=o):e-=Math.min(o,e-r)}return e}}E.Op=b,E.AttributeMap=m;const w=E;function x(e){return e?(e[0]>e[1]&&(e=[e[1],e[0]]),e):e}function k(e){return e.map((e=>"string"==typeof e.insert?e.insert:e.insert?" ":"")).join("")}const N=new Map,A={id:"",attributes:{},content:new w([{retain:1/0}]),length:1/0};var T;!function(e){function t(e=N){let t;for(;e[t=Math.random().toString(36).slice(2)];);return t}e.iterator=function(e,t){return new D(e,t)},e.linesToLineIds=function(t){const n=new Map;return t.forEach((t=>n.set(t.id||e.createId(n),t))),n},e.length=function(e){return e.length},e.getId=function(e){return console.warn("getId() is deprecated"),e.id},e.equal=function(e,t){return i(e.attributes,t.attributes)&&i(e.content.ops,t.content.ops)},e.fromDelta=function(t,n){const r=[],o=new Map(n||[]);return t.eachLine(((t,n)=>{const i=e.create(t,Object.keys(n).length?n:void 0,o);o.set(i.id,i),r.push(i)})),r},e.toDelta=function(e){let t=new w;return e.forEach((e=>{t=t.concat(e.content),t.insert("\n",e.attributes)})),t},e.create=function(e=new w,n={},r){const o=e.length()+1;return"string"!=typeof r&&(r=t(r)),{id:r,attributes:n,content:e,length:o}},e.createFrom=function(e,n=new w,r){return{id:e?e.id:t(r),attributes:e?e.attributes:{},content:n,length:1}},e.getLineRanges=function(e){const t=new Map;let n=0;return e.forEach((e=>{t.set(e,[n,n+=e.length])})),t},e.createId=t}(T||(T={}));const F=T;class D{constructor(e,t){this.lines=e,this.index=0,this.offset=0,this.lineIds=t?new Map(t):T.linesToLineIds(e)}hasNext(){return!!this.peek()}next(e){e||(e=1/0);const t=this.lines[this.index];if(t){const n=this.offset,r=t.length;if(e>=r-n?(e=r-n,this.index+=1,this.offset=0):this.offset+=e,0===n&&e>=t.length)return t;{const r=0===n?t.id:T.createId(this.lineIds),o={id:r,attributes:t.attributes,content:t.content.slice(n,e),length:e-n};return 0!==n&&this.lineIds.set(r,o),o}}return A}peek(){return this.lines[this.index]}peekLength(){return this.lines[this.index]?this.lines[this.index].length-this.offset:1/0}rest(){if(this.hasNext()){if(0===this.offset)return this.lines.slice(this.index);{const e=this.offset,t=this.index,n=this.next(),r=this.lines.slice(this.index);return this.offset=e,this.index=t,[n].concat(r)}}return[]}}var M;!function(e){e.iterator=function(e,t){return new S(e,t)},e.length=function(e){return b.length(e)}}(M||(M={}));const O=M;class S{constructor(e,t){this.lineIterator=F.iterator(e,t);const n=this.lineIterator.peek();this.opIterator=b.iterator((null==n?void 0:n.content.ops)||[])}hasNext(){return this.opIterator.hasNext()||this.lineIterator.hasNext()}next(e){let t=this.opIterator.next(e);return t.retain===1/0&&this.lineIterator.hasNext()&&(t=_(this.nextLine())),t}nextLine(){const e=this.lineIterator.next(),t=this.lineIterator.peek();return this.opIterator=new v((null==t?void 0:t.content.ops)||[]),e}peek(){return this.opIterator.hasNext()||!this.lineIterator.hasNext()?this.opIterator.peek():_(this.peekLine())}peekLine(){return this.lineIterator.peek()}peekLength(){return this.opIterator.hasNext()||!this.lineIterator.hasNext()?this.opIterator.peekLength():1}peekLineLength(){return this.lineIterator.peekLength()}peekType(){return this.opIterator.hasNext()?this.opIterator.peekType():this.lineIterator.hasNext()?"insert":"retain"}restCurrentLine(){return this.opIterator.rest()}restLines(){return this.opIterator.offset&&this.lineIterator.next(this.opIterator.offset),this.lineIterator.rest()}}function _(e){const t={insert:"\n"};return e.attributes&&(t.attributes=e.attributes),t}class C{constructor(e,t=new w,n,r){this._pos=0,this.doc=e,this.delta=t,this.selection=n,this.activeFormats=r}get contentChanged(){return this.delta.ops.length>0}get selectionChanged(){var e;return void 0!==this.selection&&!i(this.selection,null===(e=this.doc)||void 0===e?void 0:e.selection)}apply(){throw new Error("Must be overridden by creator of change (e.g. Editor).")}setDelta(e){return this.delta=e,this._pos=e.length(),this}setActiveFormats(e){return this.activeFormats=e,this}select(e){return this.selection="number"==typeof e?[e,e]:e,this}delete(e,t){if(!e||!this.doc)return this;let[n,r]=x(e);if(n=Math.max(0,n),r=Math.min(this.doc.length-1,r),n===r)return this;const o=r-n;this.doc.selection&&(this.selection=[n,n]),this.compose(n,(e=>e.delete(o)),o);const i=this.doc.getLineRange(n);if(!(null==t?void 0:t.dontFixNewline)&&i[1]<=r){const e=this.doc.getLineAt(n).attributes;this.formatLine(r,e)}return this}insert(e,t,n,r){if(!this.doc)return this;if(e=this.normalizePoint(e),this.doc.selection){const n=e+("string"==typeof t?t.length:1);this.selection=[n,n]}const{id:o,...i}=this.doc.getLineAt(e).attributes;if("string"!=typeof t)this.compose(e,(e=>e.insert(t,n)));else if("\n"===t)(null==r?void 0:r.dontFixNewline)?this.compose(e,(e=>e.insert("\n",{...n}))):(this.compose(e,(e=>e.insert("\n",i))),this.formatLine(e,{...n}));else if(n||(n=this.getFormatAt(e)),t.includes("\n")){const r=t.split("\n");this.compose(e,(e=>(r.forEach(((t,r)=>{r&&e.insert("\n",1===r?i:{}),t.length&&e.insert(t,n)})),e))),i&&this.formatLine(e,{...i})}else this.compose(e,(e=>e.insert(t,n)));return this}insertContent(e,t){if(!this.doc)return this;if(e=this.normalizePoint(e),this.doc.selection){const n=t.ops.filter((e=>e.delete));for(;n.length&&n[n.length-1].retain;)n.pop();const r=e+n.reduce(((e,t)=>e+b.length(t)),0);this.selection=[r,r]}return-1!==k(t).indexOf("\n")&&this.formatLine(e,{...this.doc.getLineFormat(e)}),this.compose(e,(e=>e.concat(t))),this}formatText(e,t){return this.doc&&(e=x(e))[1]-e[0]?(t&&Object.keys(t).forEach((e=>!1===t[e]&&(t[e]=null))),this.doc.getLineRanges(e).forEach((([n,r])=>{n=Math.max(e[0],n);const o=(r=Math.min(e[1],r-1))-n;this.compose(n,(e=>e.retain(o,t)),o)})),this):this}toggleTextFormat(e,t){return this.doc?("number"==typeof e&&(e=[e,e]),e=x(e),I(t,this.doc.getTextFormat(e))&&(t=m.invert(t)),this.formatText(e,t)):this}formatLine(e,t,n){if(!this.doc)return this;const r=this.doc;return"number"==typeof e&&(e=[e,e]),e=x(e),this.doc.getLineRanges(e).forEach((([e,o])=>{if(o--,!n){const e=m.invert(r.getLineFormat(o));t={...e,...t}}this.compose(o,(e=>e.retain(1,t)),1)})),this.delta.chop(),this}toggleLineFormat(e,t){return this.doc?("number"==typeof e&&(e=[e,e]),e=x(e),I(t,this.doc.getLineFormat(e))&&(t=m.invert(t)),this.formatLine(e,t)):this}removeFormat(e){if(!this.doc)return this;e=x(e);const t=m.invert(this.doc.getFormats(e)),n=e[1]-e[0];return this.compose(e[0],(e=>e.retain(n,t)),n)}transform(e,t){const n=this.delta.transform(e.delta,t),r=e.selection&&this.transformSelection(e.selection);return new C(null,n,r)}transformSelection(e,t){if(!e)return e;const n=this.delta.transformPosition(e[0],t),r=this.delta.transformPosition(e[1],t);return n===e[0]&&r===e[1]?e:[n,r]}transformAgainst(e,t){return(e instanceof w?new C(null,e):e).transform(this,!t)}isFor(e){return this.doc===e}clone(){var e;return new C(this.doc,new w(this.delta.ops.slice()),null===(e=this.selection)||void 0===e?void 0:e.slice())}compose(e,t,n){return this._pos<=e?this.delta=t(this.delta.retain(e-this._pos)):this.delta=this.delta.compose(t((new w).retain(e))),this._pos=Math.max(e+(n||0),this._pos),this}normalizePoint(e,t=(this.doc?this.doc.length-1:0)){return Math.max(0,Math.min(t,e))}getFormatAt(e){let n;if(this.doc){const r=this.doc.getTextFormat(e),o=this.doc.getTextFormat(e+1);r&&o&&(n=r===o?r:t(o,Object.keys(r)))}return n}}function I(e,t){return Object.keys(e).every((n=>i(t[n],e[n])))}const R=[0,0],j={},B=new WeakMap,$=new Set(["id"]);class P{constructor(e,t=null){e instanceof P?(this.lines=e.lines,this.byId=e.byId,this._ranges=e._ranges,this.length=e.length):(this.byId=new Map,Array.isArray(e)?this.lines=e:this.lines=e?F.fromDelta(e):[F.create()],this.lines.length||this.lines.push(F.create()),this.byId=F.linesToLineIds(this.lines),this.lines.forEach((e=>{if(this.byId.get(e.id)!==e)throw new Error("TextDocument has duplicate line ids: "+e.id)})),this._ranges=F.getLineRanges(this.lines),this.length=this.lines.reduce(((e,t)=>e+t.length),0)),this.selection=t&&t.map((e=>Math.min(this.length-1,Math.max(0,e))))}get change(){const e=new C(this);return e.apply=()=>this.apply(e),e}getText(e){return e&&(e=x(e)),k(e?this.slice(e[0],e[1]):this.slice(0,this.length-1))}getLineBy(e){return this.byId.get(e)}getLineAt(e){return this.lines.find((t=>{const[n,r]=this.getLineRange(t);return n<=e&&r>e}))}getLinesAt(e,t){let n=e;return Array.isArray(e)&&([e,n]=x(e)),this.lines.filter((r=>{const[o,i]=this.getLineRange(r);return t?o>=e&&i<=n:(o<n||o===e)&&i>e}))}getLineRange(e){const{lines:t,_ranges:n}=this;if("number"==typeof e){for(let r=0;r<t.length;r++){const o=n.get(t[r])||R;if(o[0]<=e&&o[1]>e)return o}return R}return"string"==typeof e&&(e=this.getLineBy(e)),n.get(e)}getLineRanges(e){return null==e?Array.from(this._ranges.values()):this.getLinesAt(e).map((e=>this.getLineRange(e)))}getLineFormat(e=this.selection,t){let n=e;return Array.isArray(e)&&([e,n]=x(e)),e===n&&n++,z(F,this.lines,e,n,void 0,t)}getTextFormat(e=this.selection,t){let n=e;return Array.isArray(e)&&([e,n]=x(e)),e===n&&e--,z(O,this.lines,e,n,(e=>"\n"!==e.insert),t)}getFormats(e=this.selection,t){return{...this.getTextFormat(e,t),...this.getLineFormat(e,t)}}slice(e=0,t=1/0){const n=[],r=O.iterator(this.lines);let o=0;for(;o<t&&r.hasNext();){let i;o<e?i=r.next(e-o):(i=r.next(t-o),n.push(i)),o+=b.length(i)}return new w(n)}apply(e,t,n){let r;if(e instanceof C?(r=e.delta,t=e.selection):r=e,!r.ops.length&&(void 0===t||i(this.selection,t)))return this;if(!r.ops.length&&t)return new P(this,t);void 0===t&&this.selection&&(t=[r.transformPosition(this.selection[0]),r.transformPosition(this.selection[1])],i(this.selection,t)&&(t=this.selection));const o=O.iterator(this.lines,this.byId),s=b.iterator(r.ops);let c=[];const l=s.peek();if(l&&l.retain&&!l.attributes){let e=l.retain;for(;o.peekLineLength()<=e;)e-=o.peekLineLength(),c.push(o.nextLine());l.retain-e>0&&s.next(l.retain-e)}if(!o.hasNext()&&n)throw new Error("apply() called with change that extends beyond document");let a=F.createFrom(o.peekLine());function u(e){e.length=e.content.length()+1,c.push(e)}for(;o.hasNext()||s.hasNext();)if("insert"===s.peekType()){const e=s.peek(),t="string"==typeof e.insert?e.insert.indexOf("\n",s.offset):-1;if(t<0)a.content.push(s.next());else{const e=t-s.offset;e&&a.content.push(s.next(e));const n=s.next(1);u(F.create(a.content,n.attributes)),a.content=new w}}else{const e=Math.min(o.peekLength(),s.peekLength()),t=o.next(e),r=s.next(e);if("number"==typeof t.retain){if(n)throw new Error("apply() called with change that extends beyond document");continue}if("number"==typeof r.retain){const e="\n"===t.insert;let n=t;const l=r.attributes&&m.compose(t.attributes,r.attributes);if(r.attributes&&!i(l,t.attributes)&&(e?a.attributes=l||{}:(n={insert:t.insert},l&&(n.attributes=l))),e?(u(a),a=F.createFrom(o.peekLine())):a.content.push(n),r.retain===1/0||!s.hasNext()){if(0!==o.opIterator.index||0!==o.opIterator.offset){const e=o.restCurrentLine();for(let t=0;t<e.length;t++)a.content.push(e[t]);u(a),o.nextLine()}c.push(...o.restLines());break}}else"number"==typeof r.delete&&"\n"===t.insert&&(a=F.createFrom(o.peekLine(),a.content))}return new P(c,t)}replace(e,t){return new P(e,t)}toDelta(){const e=B;let t=e.get(this);return t||(t=F.toDelta(this.lines),e.set(this,t)),t}equals(e,t){return this===e||((null==t?void 0:t.contentOnly)||i(this.selection,e.selection))&&i(this.lines,e.lines,{excludeProps:$})}toJSON(){return this.toDelta()}toString(){return this.lines.map((e=>e.content.map((e=>"string"==typeof e.insert?e.insert:" ")).join(""))).join("\n")+"\n"}}function z(e,t,n,r,o,i){const s=e.iterator(t);let c,l=0;for(s.skip&&(l+=s.skip(n));l<r&&s.hasNext();){let t=s.next();l+=e.length(t),l>n&&(!o||o(t))&&(c=t.attributes?c?(null==i?void 0:i.allFormats)?m.compose(c,t.attributes):q(c,t.attributes,null==i?void 0:i.nameOnly):{...t.attributes}:{})}return c||j}function q(e,t,n){return Object.keys(t).reduce((function(r,o){return n?o in e&&o in t&&(r[o]=!0):i(e[o],t[o],{partial:!0})?r[o]=t[o]:i(t[o],e[o],{partial:!0})&&(r[o]=e[o]),r}),{})}const W={renderKeys:!1},K=[],V="data-key",H=new Set(["value","selected","checked","contentEditable"]),X=e=>null==e?e:e.key,Z=(e,t)=>{t&&t!==e.key&&(e.key=t,W.renderKeys&&e.setAttribute(V,t)),!t&&e.key&&(delete e.key,W.renderKeys&&e.removeAttribute(V))},U=e=>{e.currentTarget.events[e.type](e)},J=(e,t,n,r,o)=>{"key"===t||("o"===t[0]&&"n"===t[1]?((e.events||(e.events={}))[t=t.slice(2)]=r)?n||e.addEventListener(t,U):e.removeEventListener(t,U):null==r?e.removeAttribute(t):!o&&"list"!==t&&"form"!==t&&t in e?e[t]=null==r?"":r:e.setAttribute(t,r))},Q=(e,t)=>{if("string"==typeof e)return document.createTextNode(e);var n=e.props,r=(t=t||"svg"===e.type)?document.createElementNS("http://www.w3.org/2000/svg",e.type,{is:n.is}):document.createElement(e.type,{is:n.is});for(var o in n)J(r,o,null,n[o],t);return Z(r,X(e)),e.children.forEach((e=>r.appendChild(Q(te(e),t)))),r},Y=(e,t)=>{const n={};for(let r=0;r<e.attributes.length;r++){const{name:o,value:i}=e.attributes[r];o in e&&"list"!==o&&!t?n[o]=e[o]:W.renderKeys&&o===V||(n[o]=""===i||i)}return n},G=(e,t,n,r,o)=>{if("string"==typeof r)null!=n&&n.nodeType===Node.TEXT_NODE?n.nodeValue!==r&&(t.nodeValue=r):(t=e.insertBefore(Q(r,o),t),null!=n&&e.removeChild(n));else if(null==n||n.nodeName.toLowerCase()!==r.type)t=e.insertBefore(Q(te(r),o),t),null!=n&&e.removeChild(n);else{var i=Y(n,o),s=r.props;for(var c in o=o||"svg"===r.type,{...i,...s})(H.has(c)?t[c]:i[c])!==s[c]&&J(t,c,i[c],s[c],o);Z(t,r.key),ee(t,r.children,o)}return t},ee=(e,t,n,r=Array.from(e.childNodes))=>{for(var o,i,s,c,l=0,a=0,u=r.length-1,h=t.length-1;a<=h&&l<=u&&null!=(s=X(r[l]))&&s===X(t[a]);)G(e,r[l],r[l++],t[a]=te(t[a++]),n);for(;a<=h&&l<=u&&null!=(s=X(r[u]))&&s===X(t[h]);)r[u]=G(e,r[u],r[u--],t[h]=te(t[h--]),n);if(l>u){const o=r[l]||r[l-1]&&r[l-1].nextSibling||null;for(;a<=h;)e.insertBefore(Q(t[a]=te(t[a++]),n),o)}else if(a>h)for(;l<=u;)e.removeChild(r[l++]);else{const d=new Map,f=new Set;for(let e=l;e<=u;e++)null!=(s=X(r[e]))&&d.set(s,r[e]);for(;a<=h;)s=X(i=r[l]),c=X(t[a]=te(t[a])),f.has(s)||null!=c&&c===X(r[l+1])?(null==s&&e.removeChild(i),l++):null==c?(null==s&&(G(e,i,i,t[a],n),a++),l++):(s===c?(G(e,i,i,t[a],n),f.add(c),l++):null!=(o=d.get(c))?(G(e,e.insertBefore(o,i),o,t[a],n),f.add(c)):G(e,i,null,t[a],n),a++);for(;l<=u;)null==X(i=r[l++])&&e.removeChild(i);for(const[t,n]of d)f.has(t)||e.removeChild(n)}return e},te=e=>!0!==e&&!1!==e&&e?e:"",ne=(e,t,n,r)=>({type:e,props:t,children:n,key:r}),re=e=>e.nodeType===Node.TEXT_NODE?e.nodeValue:ne(e.nodeName.toLowerCase(),Y(e),K.map.call(e.childNodes,re),X(e)),oe=(e,t,n)=>"function"==typeof e?e(t||{},n):ne(e,t||{},Array.isArray(n)?n:null==n?[]:[n],null==t?void 0:t.key),ie={createElement:oe},se=(e,t,n)=>Array.isArray(t)?ee(e,t,e instanceof window.SVGElement,n):G(e.parentNode,e,e,t),ce=[],le={},ae={},ue={},he=(e,t)=>!0;class de{constructor(e){var t,n,r;const o=null===(t=e.lines)||void 0===t?void 0:t.map((e=>"string"==typeof e?le[e]:e)).filter(Boolean),i=null===(n=e.formats)||void 0===n?void 0:n.map((e=>"string"==typeof e?ae[e]:e)).filter(Boolean),s=null===(r=e.embeds)||void 0===r?void 0:r.map((e=>"string"==typeof e?ue[e]:e)).filter(Boolean);this.lines=new me(o||ce),this.formats=new me(i||ce),this.embeds=new me(s||ce)}}function fe(e){return e.renderMultiple&&!e.shouldCombine&&(e.shouldCombine=he),le[e.name]=e}function pe(e){return ae[e.name]=e}function ge(e){return ue[e.name]=e}de.line=fe,de.format=pe,de.embed=ge;class me{constructor(e){this.list=e,this.init()}get default(){return this.list[0]}init(){this.selector=this.list.map((e=>e.selector||"")).filter(Boolean).join(", "),this.types=this.list.reduce(((e,t)=>(e[t.name]=t,e)),{}),this.priorities=this.list.reduce(((e,t,n)=>(e[t.name]=n,e)),{})}add(e){this.list.push(e),this.init()}remove(e){const t="string"==typeof e?e:e.name;this.list=this.list.filter((e=>e.name!==t)),this.init()}get(e){return this.types[e]}priority(e){const t=this.priorities[e];return void 0!==t?t:-1}matches(e){if(!e)return!1;if(!e.nodeType)throw new Error("Cannot match against "+e);return e.nodeType===Node.ELEMENT_NODE?!!this.selector&&e.matches(this.selector):void 0}findByNode(e,t=!1){if(e.nodeType!==Node.ELEMENT_NODE)return;let n=this.list.length;for(;n--;){let t=this.list[n];if(e.matches(t.selector))return t}return t?this.default:void 0}findByAttributes(e,t=!1){const n=e&&Object.keys(e);let r;return n&&n.every((e=>!(r=this.get(e)))),r||(t?this.default:void 0)}}const ye=/;\s*$/,be={name:"decoration",selector:"span.format.decoration",fromDom:!1,render:(e,t)=>xe(oe("span",{},t),e,["format","decoration"])},ve={name:"decoration",selector:".embed.decoration",fromDom:!1,noFill:!0,render:(e,t)=>{const n="embed decoration",{name:r,...o}=e.decoration;return o.class=o.class?n+" "+o.class:n,oe(r||"span",o,t)}};class Le extends Event{constructor(e,t){super(e,t),this.old=t.old,this.doc=t.doc,this.change=t.change,this.changedLines=t.changedLines}}function Ee(e){e.typeset.formats.add(be),e.typeset.embeds.add(ve);const t=new Map;let n=e.doc,r=n,o=n,s=!1;function c(i){var c,l;if(!i)throw new TypeError("A decoration name is required");const a=t.get(i);if(!a)return!1;const u=ke(i,a,n);return t.delete(i),o=t.size?o.apply(u):n,s||(null===(c=e.modules.rendering)||void 0===c||c.render({old:r,doc:o}),null===(l=e.modules.selection)||void 0===l||l.renderSelection()),!0}function l(){t.size&&t.clear(),o=n}function a(c,l){var a,u;const h=t.get(c),d=h?h.compose(l,!0):l;i(d,h)||!h&&!d.ops.length||(d.ops.length?t.set(c,d):t.delete(c),o=t.size?o.apply(l,null):n,s||(null===(a=e.modules.rendering)||void 0===a||a.render({old:r,doc:o}),null===(u=e.modules.selection)||void 0===u||u.renderSelection()))}function u(e){const{change:r,changedLines:i}=e;if(n=e.doc,r){if(r.contentChanged){for(let[e,n]of t)n=r.delta.transform(n,!0),n.ops.length?t.set(e,n):t.delete(e);o=t.size?o.apply(r.delta,null):n,t.size&&o.lines.forEach(((e,t)=>{const r=n.lines[t];e!==r&&e.id!==r.id&&(e.id=r.id)}))}}else l();h(r,i)}function h(t,o){const i={old:r,doc:n,change:t,changedLines:o};s=!0,e.dispatchEvent(new Le("decorate",i)),s=!1}function d(){r=o}return e.on("change",u),e.on("render",d),{get old(){return r},get doc(){return o},getDecorator:function(n){if(!n)throw new TypeError("A decoration name is required");const r=t.get(n);return new we(n,e.doc,r,a,c)},removeDecorations:c,clearDecorations:l,gatherDecorations:h,init(){h()},destroy(){e.off("change",u),e.off("render",d)}}}class we{constructor(e,t,n,r,o){this._name=e,this._doc=t,this.change=new C(t),this._decoration=n,this._apply=r,this._remove=o}hasDecorations(){return!!this._decoration&&this._decoration.ops.length>0||this.change.delta.ops.length>0}getDecoration(){return this._decoration?this._decoration.compose(this.change.delta):this.change.delta}apply(){return this._apply(this._name,this.change.delta)}remove(){return this._remove(this._name)}clear(e){return this.hasDecorations()?(e?this.change.setDelta(this.change.delta.compose(this.invert(e))):this.change.setDelta(this.invert()),this):this}clearLines(e){if(!e.length)return this;const t=this._doc,n=[t.getLineRange(e[0])[0],t.getLineRange(e[e.length-1])[1]];if(1===e.length||e.every(((n,r)=>!r||t.getLineRange(e[r-1])[1]===t.getLineRange(n)[0])))return this.clear(n);const r=this.invert(n),o=new w;let i=0;return e.forEach((e=>{const[n,s]=t.getLineRange(e);o.retain(n-i).concat(r.slice(n,s)),i=s})),this.change.setDelta(this.change.delta.compose(o)),this}clearLine(e){const t=this._doc,n="number"==typeof e?t.getLineAt(e):"string"==typeof e?t.getLineBy(e):e;return this.clearLines([n])}invert(e){return this._decoration?ke(this._name,this._decoration,this._doc,e):new w}decorateText(e,t={class:this._name}){return this.change.formatText(e,{decoration:{[this._name]:t}}),this}decorateLine(e,t={class:this._name}){return this.change.formatLine(e,{decoration:{[this._name]:t}},!0),this}insertDecoration(e,t={class:this._name}){if("string"==typeof t)throw new Error("You may only insert embed decorations");return this.change.insert(e,{decoration:t}),this}}function xe(e,t,n){if(!t||!t.decoration)return e;const r=new Set(n);let o="",i=e.props;Object.values(t.decoration).forEach((e=>{const{class:t,style:n,...s}=e;t&&r.add(t.trim()),n&&(o+=n.trim()),o&&!ye.test(o)&&(o+=";"),i={...s,...i}}));const s=Array.from(r).join(" ").trim();return s&&(i.class=i.class?i.class+" "+s:s),o&&(i.style=i.style?i.style+";"+o:o),e.props=i,e}function ke(e,t,n,r){let o=n.toDelta();return r&&(o=o.slice(r[0],r[1]),t=t.slice(r[0],r[1])),(t=t.invert(o)).ops.forEach((t=>{var n;null===(null===(n=t.attributes)||void 0===n?void 0:n.decoration)&&(t.attributes.decoration={[e]:null})})),r&&(t=(new w).retain(r[0]).concat(t)),t}const Ne=[],Ae=oe("br",{}),Te=new WeakMap,Fe=new WeakMap,De=new WeakMap,Me=new WeakMap,Oe=new WeakMap;function Se(e,t){var n,r;return null===(r=null===(n=Oe.get(e))||void 0===n?void 0:n.get(t))||void 0===r?void 0:r[0]}function _e(e,t){var n,r;return null===(r=null===(n=Oe.get(e))||void 0===n?void 0:n.get(t))||void 0===r?void 0:r[1]}function Ce(e){const{root:t,doc:n}=e,r=qe(e,n.lines),o=new WeakMap;for(let i=0;i<t.children.length;i++){const s=t.children[i];if(!s.key)continue;const c=r.byKey[s.key];if(c)if(Array.isArray(c)){o.set(s,[n.getLineRange(c[0])[0],n.getLineRange(c[c.length-1])[1]]);const t=s.querySelectorAll(e.typeset.lines.selector);for(let e=0;e<t.length;e++){const r=t[e],i=n.getLineBy(r.key);i&&o.set(r,n.getLineRange(i))}}else o.set(s,n.getLineRange(c))}const i=t.querySelectorAll(e.typeset.lines.selector);for(let e=0;e<i.length;e++){const t=i[e];if(o.has(t)||!t.key)continue;const r=n.getLineBy(t.key);o.set(t,n.getLineRange(r))}Oe.set(t,o)}function Ie(e,t){const{root:n}=e;e.dispatchEvent(new Event("rendering")),se(n,je(e,t)),Ce(e),e.dispatchEvent(new Event("render")),e.dispatchEvent(new Event("rendered"))}function Re(e,t,n){const{root:r}=e,o=qe(e,t.lines).combined,s=qe(e,n.lines).combined,[c,l]=We(o,s);i(c,l)||(c[0]=Math.max(0,c[0]-1),l[0]=Math.max(0,l[0]-1),c[1]=Math.min(o.length,c[1]+1),l[1]=Math.min(s.length,l[1]+1),r.childNodes.length!==o.length&&(c[1]+=r.childNodes.length-o.length));const a=Array.from(r.childNodes).slice(c[0],c[1]),u=s.slice(l[0],l[1]);if(!a.length&&!u.length)return Ie(e,n);e.dispatchEvent(new Event("rendering")),se(r,Be(e,u),a),Ce(e),e.dispatchEvent(new Event("render")),e.dispatchEvent(new Event("rendered"))}function je(e,t,n){return Be(e,qe(e,t.lines).combined,n)}function Be(e,t,n){return t.map((t=>$e(e,t,n))).filter(Boolean)}function $e(e,t,n){return Array.isArray(t)?ze(e,t,n):Pe(e,t,n)}function Pe(e,t,n){const r=He(e,t);if(!r.render)throw new Error("No render method defined for line");const o=r.render(t.attributes,Ke(e,t.content),e,n);return xe(o,t.attributes),o.key=t.id,o}function ze(e,t,n){const r=He(e,t[0]);if(!r.renderMultiple)throw new Error("No render method defined for line");const o=r.renderMultiple(t.map((t=>[t.attributes,Ke(e,t.content),t.id])),e,n);return o.key=t[0].id,o}function qe(e,t){const n=Me.get(t);if(n)return n;const r=[],o={};let i=[];t.forEach(((n,s)=>{const c=He(e,n);if(c.shouldCombine){i.push(n);const l=t[s+1];if(!l||He(e,l)!==c||!c.shouldCombine(n.attributes,l.attributes)){const e=De.get(i[0]);e&&e.length===i.length&&i.every(((t,n)=>e[n]===t))?i=e:De.set(i[0],i),r.push(i),o[i[0].id]=i,i=[]}}else c.render&&(r.push(n),o[n.id]=n)}));const s={combined:r,byKey:o};return Me.set(t,s),s}function We(e,t){const n=e.length,r=t.length,o=Math.min(n,r);let i=0,s=0,c=0,l=0;for(let n=0;n<o;n++)if(!Ve(e[n],t[n])){i=c=n;break}for(let i=0;i<o;i++)if(!Ve(e[n-i-1],t[r-i-1])){s=n-i,l=r-i;break}return[[i,s],[c,l]]}function Ke(e,t,n){const{formats:r,embeds:o}=e.typeset;let i=[],s=!0;return t.ops.forEach(((t,c,l)=>{let a=[];if("string"==typeof t.insert){const e=l[c-1],n=l[c+1];let r=t.insert.replace(/  /g,"  ").replace(/  /g,"  ");e&&"object"!=typeof e.insert||(r=r.replace(/^ /," ")),n&&"object"!=typeof n.insert&&!function(e){return"string"==typeof e.insert&&" "===e.insert[0]}(n)||(r=r.replace(/ $/," ")),s=!1,a.push(r)}else if(t.insert){const r=o.findByAttributes(t.insert);(null==r?void 0:r.render)&&(a.push(r.render(t.insert,Ne,e,n)),"br"===r.name?s=!0:r.noFill||(s=!1))}t.attributes&&Object.keys(t.attributes).sort(((e,t)=>r.priority(t)-r.priority(e))).forEach((o=>{const i=r.get(o);if(null==i?void 0:i.render){const r=i.render(t.attributes,a,e,n);r&&(Te.set(r,i),a=[r])}})),i.push.apply(i,a)})),i=Xe(i),s&&i.push(Ae),i}function Ve(e,t){return e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(((e,n)=>e===t[n]))}function He(e,t){let n=Fe.get(t.attributes);return n||(n=e.typeset.lines.findByAttributes(t.attributes,!0),Fe.set(t.attributes,n)),n}function Xe(e){const t=[];if(e.forEach(((e,n)=>{const r=t.length-1,o=t[r];o&&"string"!=typeof o&&"string"!=typeof e&&Te.has(o)&&Te.get(o)===Te.get(e)&&i(o.props,e.props)?o.children=o.children.concat(e.children):o&&"string"==typeof o&&"string"==typeof e?t[r]+=e:(t.push(e),o&&"string"!=typeof o&&o.children&&(o.children=Xe(o.children)))})),t.length){const e=t[t.length-1];e&&"string"!=typeof e&&e.children&&(e.children=Xe(e.children))}return t}const Ze=/["'&<>]/;function Ue(e){var t,n=""+e,r=Ze.exec(n);if(!r)return n;var o="",i=0,s=0;for(i=r.index;i<n.length;i++){switch(n.charCodeAt(i)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}s!==i&&(o+=n.substring(s,i)),s=i+1,o+=t}return s!==i?o+n.substring(s,i):o}const Je=NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT;function Qe(e,t){return(e.ownerDocument||document).createTreeWalker(e,Je,{acceptNode(e){if(e.nodeType===Node.TEXT_NODE&&""===e.nodeValue)return NodeFilter.FILTER_REJECT;if(t){const n=t(e);return n?!0===n?NodeFilter.FILTER_ACCEPT:n:NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT}})}const Ye="address, article, aside, blockquote, editor, dd, div, dl, dt, fieldset, figcaption, figure, footer, form, h1, h2, h3, h4, h5, h6, header, hr, li, main, nav, noscript, ol, output, p, pre, section, table, tfoot, ul, video",Ge=/[\0-\x09\x0B\x1F\x7F-\x9F\xAD\u0600-\u0605\u061C\u06DD\u070F\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB\uE000-\uF8FF]/g,et={STYLE:!0,SCRIPT:!0,LINK:!0,META:!0,TITLE:!0},tt={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},nt=/[ \t\n\r]+/g,rt=document.createElement("div"),ot={};function it(e,t){return"BR"===t.nodeName&&function(e,t){const n=t.closest&&t.closest(e.typeset.lines.selector);if(!n)return!1;const r=Qe(n);r.currentNode=t;const o=r.nextNode();return!o||o instanceof HTMLElement&&o.matches(Ye)}(e,t)}function st(e,t){return pt(je(e,t,!0))}function ct(e,t){return pt(Ke(e,t,!0))}function lt(e,t,n){return new P(at(e,t),n)}function at(e,t,n){const r=ft(e,{root:(new window.DOMParser).parseFromString(t,"text/html").body,possiblePartial:null==n?void 0:n.possiblePartial,collapseWhitespace:null==n?void 0:n.collapseWhitespace});return dt(r),r}function ut(e,t){return new P(ft(e,{root:t}))}function ht(e,t){const n=F.fromDelta(ft(e,{root:t}),e.doc.byId);if(n.length)return e.typeset.lines.findByAttributes(n[0].attributes,!0).renderMultiple?n:n[0]}function dt(e){e.forEach((e=>{"string"==typeof e.insert&&(e.insert=e.insert.replace(Ge,""))}))}function ft(e,t=ot){const{lines:n,embeds:r}=e.typeset,o=t.root||e.root,i=null==t.collapseWhitespace||t.collapseWhitespace;var s=Qe(o,(e=>!et[e.nodeName]));const c=new w;let l,a,u=!1,h=!1,d=!0;for(t.startNode?(s.currentNode=t.startNode,s.previousNode(),t.offset&&c.retain(t.offset,void 0)):s.currentNode=o;(a=s.nextNode())&&a!==t.endNode;)if(it(e,a))d=!1;else if("BR"===a.nodeName&&"Apple-interchange-newline"===a.className)c.insert("\n",!l||l.unknownLine?{}:l);else if(a.nodeType===Node.TEXT_NODE){let t=a.parentNode;if(null==a.nodeValue||""===a.nodeValue.replace(/\n+/g,""))continue;if(!a.nodeValue.replace(/\s+/g,"")&&(a.parentNode===o||a.previousSibling&&n.matches(a.previousSibling)||a.nextSibling&&n.matches(a.nextSibling)))continue;const r=a.nodeValue,s=(i?r.replace(nt," "):r).replace(/\xA0/g," ");if(!s||" "===s&&t.classList.contains("EOP"))continue;const l=gt(t,o,e);d=!1,c.insert(s,l)}else if(r.matches(a)){const t=r.findByNode(a);if(t){const n=gt(a.parentNode,o,e);!1!==t.fromDom&&c.insert(t.fromDom?t.fromDom(a):{[t.name]:!0},n)}}else if(n.matches(a)||a.nodeType===Node.ELEMENT_NODE&&a.matches(Ye)){if(h=!n.matches(a),h){let e=a.parentNode;for(;e&&!n.matches(e)&&e!==o;)e=e.parentNode;if(e&&e!==o)continue}const e=n.findByNode(a,!0);if(e===n.default&&(!a.parentNode||n.matches(a.parentNode)))continue;if(e.frozen)for(;s.lastChild(););u?l&&l.unknownLine&&d||(c.insert("\n",!l||l.unknownLine?{}:l),d=!0):u=!0,l=h?{unknownLine:h}:e&&e!==n.default?e.fromDom?e.fromDom(a):{[e.name]:!0}:{},t.includeIds&&a.key&&(l.id=a.key)}return h&&d||!u&&t.possiblePartial||c.insert("\n",!l||l.unknownLine?{}:l),c}function pt(e){return e&&e.length?e.reduce(((e,t)=>e+("string"!=typeof t?function(e){if("string"==typeof e){rt.textContent=e;const t=rt.innerHTML;return rt.textContent="",t}const t=Object.keys(e.props).reduce(((t,n)=>"key"===n||null==e.props[n]?t:`${t} ${Ue(n)}="${Ue(e.props[n])}"`),""),n=pt(e.children),r=n||!tt[e.type]?`</${e.type}>`:"";return`<${e.type}${t}>${n}${r}`}(t):Ue(t).replace(/\xA0/g,"&nbsp;"))),""):""}function gt(e,t,n){const{lines:r,formats:o}=n.typeset,i={};for(;e&&!r.matches(e)&&e!==t;){if(o.matches(e)){const t=o.findByNode(e);t&&!1!==t.fromDom&&(i[t.name]=!t.fromDom||t.fromDom(e))}else e.hasAttribute("style")&&o.list.forEach((t=>{t.styleSelector&&e.matches(t.styleSelector)&&(i[t.name]=!t.fromDom||t.fromDom(e))}));e=e.parentNode}return i}const mt=[null,0];function yt(e,t,n){const r=e.root.ownerDocument;if("caretPositionFromPoint"in r)try{const o=r.caretPositionFromPoint(t,n);if(o)return Et(e,o.offsetNode,o.offset)}catch(e){}if(r.caretRangeFromPoint){const o=r.caretRangeFromPoint(t,n);if(o)return Et(e,o.startContainer,o.startOffset)}return null}function bt(e,t){const{root:n}=e;if(!n.ownerDocument)return;const r=Array.from(n.querySelectorAll(e.typeset.lines.selector)).filter((e=>e.key)),o=r[r.length-1];for(const n of r){const r=n.getBoundingClientRect();if(r.bottom>=t||n===o)return{line:e.doc.getLineBy(n.key),element:n,rect:r,belowMid:t>r.top+r.height/2}}}function vt(e,t){t[0]>t[1]&&(t=[t[1],t[0]]);const[n,r,o,i]=Nt(e,t),s=e.root.ownerDocument.createRange();return n&&o&&(s.setStart(n,r),s.setEnd(o,i)),s}function Lt(e,t){const n=vt(e,t);if((null==n?void 0:n.endContainer.nodeType)===Node.ELEMENT_NODE)try{n.setEnd(n.endContainer,n.endOffset+1)}catch(e){}return n}function Et(e,t,n,r){var o;const{root:i}=e,{lines:s}=e.typeset;if(!i.contains(t))return-1;if(t.nodeType===Node.ELEMENT_NODE){if(t.childNodes.length===n){if(null!=_e(i,t))return _e(i,t)-1;t.childNodes.length&&(n=kt(e,t=t.childNodes[n-1]))}else t=t.childNodes[n],n=0;const c=Se(i,t);if(null!=c)return(null===(o=s.findByNode(t))||void 0===o?void 0:o.frozen)?c+n:(null==r||r<c?c:c-1)+n}return wt(e,t)+n}function wt(e,t){var n;const{root:r}=e;if(!r.ownerDocument)return-1;const{lines:o,embeds:i}=e.typeset,s=Qe(r);let c;s.currentNode=t;let l,a=0;for(;(c=s.previousNode())&&c!==r;){if(null!=(l=Se(r,c))){a+=l;break}c.nodeType===Node.TEXT_NODE?a+=Tt(o,c):(null===(n=c.classList)||void 0===n?void 0:n.contains("decoration"))||(i.matches(c)&&!it(e,c)||o.matches(c)&&e.doc.lines[0].id!==c.key)&&a++}return a}function xt(e,t){const{root:n}=e;if(n.ownerDocument)return Array.from(n.childNodes).find((e=>Se(n,e)<=t&&_e(n,e)>t))}function kt(e,t){var n;const{lines:r,embeds:o}=e.typeset;if(o.matches(t)&&!it(e,t))return 1;if(t.nodeType===Node.TEXT_NODE)return Tt(r,t);const i=Qe(t);let s,c=r.findByNode(t)?1:0;for(;s=i.nextNode();)s.nodeType===Node.TEXT_NODE?c+=Tt(r,s):(null===(n=s.classList)||void 0===n?void 0:n.contains("decoration"))||(o.matches(s)&&!it(e,s)||r.matches(s))&&c++;return c}function Nt(e,t){if(null==t)return[null,0,null,0];{const n=t[0]<=t[1],r=n?1:-1,o=t[0]===t[1],[i,s,c]=At(e,t[0],n?0:1),[l,a]=o&&!c?[i,s]:c&&(o||t[1]-t[0]==r*e.doc.getLineAt(t[0]).length)?[i,s+(n?1:-1)]:At(e,t[1],n?1:0);return[i,s,l,a]}}function At(e,t,n){var r;const{root:o}=e;if(!o.ownerDocument)return mt;const{lines:i,embeds:s}=e.typeset,c=Array.from(o.childNodes),l=xt(e,t);if(!l)return mt;if(i.findByNode(l,!0).frozen)return[l.parentNode,c.indexOf(l)+n,!0];const a=!(t-=Se(o,l)),u=Qe(l);let h,d=!1;for(;h=u.nextNode();)if(h.nodeType===Node.TEXT_NODE){const e=Tt(i,h);if(t<=e)return[h,t];t-=e}else if(null===(r=h.classList)||void 0===r?void 0:r.contains("decoration"));else if(s.matches(h)&&!it(e,h)){const e=s.findByNode(h);if(!e||!1===e.fromDom)continue;if((t-=1)<=0){const e=Array.from(h.parentNode.childNodes);return[h.parentNode,e.indexOf(h)+1+t]}}else if(i.matches(h)&&(d?t-=1:d=!0,0===t)){const e=u.firstChild();return e&&e.nodeType===Node.TEXT_NODE?[e,0]:e?[h,Array.from(h.childNodes).indexOf(e)]:[h,0]}return a?[l,0]:mt}function Tt(e,t){const n=t.nodeValue||"";return n.trim()||!e.matches(t.previousSibling)&&!e.matches(t.nextSibling)?n.length:0}function Ft(e){var t;const{root:n}=e,r=e.doc.selection;if(!n.ownerDocument)return null;const o=n.ownerDocument.getSelection(),{lines:i}=e.typeset;if(null!=o&&null!=o.anchorNode&&null!=o.focusNode&&n.contains(o.anchorNode)){const n=Et(e,o.anchorNode,o.anchorOffset,r&&r[0]),s=o.anchorNode===o.focusNode&&o.anchorOffset===o.focusOffset,c=i.findByAttributes(null===(t=e.doc.getLineAt(n))||void 0===t?void 0:t.attributes,!0).frozen;return[n,s?n:Et(e,o.focusNode,o.focusOffset,!c&&r?r[1]:null)]}return null}function Dt(e,t){const{root:n}=e;if(!n.ownerDocument)return;const r=n.ownerDocument.getSelection();if(!r)return;const o=r.anchorNode&&n.contains(r.anchorNode)&&document.activeElement!==document.body;if(null==t)o&&(r.removeAllRanges(),n.classList.contains("focus")&&n.classList.remove("focus"));else{const[i,s,c,l]=Nt(e,t),a=t[0]===t[1]?"Caret":"Range";i&&c&&(r.anchorNode===i&&r.anchorOffset===s&&r.focusNode===c&&r.focusOffset===l&&r.type===a||r.setBaseAndExtent(i,s,c,l)),o||n.focus(),n.classList.contains("focus")||n.classList.add("focus")}n.dispatchEvent(new Event("select",{bubbles:!0}))}var Mt;!function(e){e.api="api",e.user="user",e.history="history",e.input="input",e.paste="paste"}(Mt||(Mt={}));const Ot=function(e={}){return function(t){let n=0,r="",o=!1,i={undo:[],redo:[]};const s={maxStack:500,delay:0,...e};function c(e){"historyUndo"===e.inputType?(e.preventDefault(),l()):"historyRedo"===e.inputType&&(e.preventDefault(),a())}function l(){p("undo","redo")}function a(){p("redo","undo")}function u(){return i.undo.length>0}function h(){return i.redo.length>0}function d(){n=0}function f(){i={undo:[],redo:[]}}function p(e,n){if(0===i[e].length)return;const r=i[e].pop();i[n].push(r),d(),o=!0,"function"==typeof r[e]?r[e]():t.update(r[e],Mt.history),o=!1}function g({change:e,old:t,source:c}){return e?o?void 0:e.contentChanged?void(c!==Mt.api?function(e,t){const o=Date.now(),c=function(e){var t;const{ops:n}=e.delta;let r=0,o=n.length-1;if(n[r].retain&&!n[r].attributes&&r++,1===n[o].retain&&(null===(t=n[o].attributes)||void 0===t?void 0:t.id)&&o--,r===o){const e=n[r];if(e.delete)return"delete";if("\n"===e.insert)return"newline";if("string"==typeof e.insert)return"insert"}return""}(e);i.redo.length=0;const l=new C(null,e.delta.invert(t.toDelta()),t.selection);if(c&&r===c||d(),r=c,n&&(!s.delay||n+s.delay>o)&&i.undo.length){const t=i.undo[i.undo.length-1];t.redo.delta=t.redo.delta.compose(e.delta),t.redo.selection=e.selection,t.undo.delta=l.delta.compose(t.undo.delta)}else{const t=new C(null,e.delta,e.selection);n=o,i.undo.push({redo:t,undo:l})}i.undo.length>s.maxStack&&i.undo.shift()}(e,t):function(e,t){const n=t instanceof w?new C(null,t):t;e.undo.forEach((e=>{e.undo=n.transform(e.undo,!0),e.redo=n.transform(e.redo,!0)})),e.redo.forEach((e=>{e.undo=n.transform(e.undo,!0),e.redo=n.transform(e.redo,!0)}))}(i,e)):d():f()}return{options:s,hasUndo:u,hasRedo:h,undo:l,redo:a,cutoffHistory:d,clearHistory:f,setStack:function(e){i=e},getStack:function(){return i},getActive:()=>({undo:u(),redo:h()}),commands:{undo:l,redo:a},shortcuts:{"win:Ctrl+Z":"undo","mac:Cmd+Z":"undo","win:Ctrl+Y":"redo","mac:Cmd+Shift+Z":"redo"},init(){t.on("change",g),t.root.addEventListener("beforeinput",c)},destroy(){t.off("change",g),t.root.removeEventListener("beforeinput",c)}}}}();function St(){return{undo:[],redo:[]}}const _t=!(navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)&&/Mobi|Android/.test(navigator.userAgent)&&!window.MSStream,Ct={characterData:!0,characterDataOldValue:!0,subtree:!0,childList:!0};function It(e){let t=!1;function n(){const e=o.takeRecords();e.length&&r(e)}function r(n){if(!e.enabled)return e.render();let r=function(t){const n=function(e){const t=new Set;if((e=e.filter((e=>"characterData"!==e.type||!t.has(e.target)&&(t.add(e.target),!0)))).length>3)return null;const n=e.find((e=>"characterData"===e.type));if(!n)return null;const r=e.find((e=>1===e.addedNodes.length&&"#text"===e.addedNodes[0].nodeName));return 1+(r?1:0)+(e.find((e=>1===e.addedNodes.length&&"BR"===e.addedNodes[0].nodeName||1===e.removedNodes.length&&"BR"===e.removedNodes[0].nodeName))?1:0)<e.length||r&&r.addedNodes[0]!==n.target?null:n}(t);if(!n||null==n.oldValue||null==n.target.nodeValue)return null;const r=new w,o=wt(e,n.target);let i;return r.retain(o),e.doc.selection&&(i=x(e.doc.selection)[0]-o,i<0&&(i=0)),l()(n.oldValue.replace(/\xA0/g," "),n.target.nodeValue.replace(/\xA0/g," "),i).forEach((([t,n])=>{t===l().EQUAL?r.retain(n.length):t===l().DELETE?r.delete(n.length):t===l().INSERT&&r.insert(n,e.activeFormats)})),r.chop(),r}(n),o=Ft(e);if(r||(r=function(t){const{doc:n}=e;if(t){const[r,o]=t,i=Se(e.root,r),s=_e(e.root,o),c=ft(e,{startNode:r,endNode:o.nextElementSibling||void 0,collapseWhitespace:!1});let l=n.toDelta().slice(i,s).diff(c);return l.ops.length&&i&&(l=(new w).retain(i).concat(l)),l}{const t=ft(e,{collapseWhitespace:!1});return n.toDelta().diff(t)}}(function(e,t){let n,r;for(let o=0;o<t.length;o++){const i=t[o];if(i.target===e)return;const s=Rt(e,i.target);if(!s||!s.key)return;(!n||Se(e,s)<Se(e,n))&&(n=s),(!r||Se(e,s)>Se(e,r))&&(r=s)}if(n&&r)return[n,r]}(e.root,n))),t&&(function(e){let t=!1;const n=e.ops[e.ops.length-1];return n.insert&&n.insert.br&&(t=!0),t}(r)&&(r.ops.pop(),r.insert("\n")),null!==o&&(o[0]++,o[1]++),t=!1),r&&r.ops.length){dt(r);const t=e.doc;e.update(new C(e.doc,r,o,e.activeFormats),Mt.input),e.doc.lines===t.lines&&e.render()}}const o=new window.MutationObserver(r);function i(){o.disconnect()}function s(){o.observe(e.root,Ct)}function c(e){e.data&&e.data.includes("\n")&&(t=!0)}return{init(){e.root.addEventListener("input",n),e.on("rendering",i),e.on("render",s),_t&&e.root.addEventListener("beforeinput",c)},destroy(){o.disconnect(),e.root.removeEventListener("input",n),e.off("rendering",i),e.off("render",s),_t&&e.root.removeEventListener("beforeinput",c)}}}function Rt(e,t){for(;t&&t.parentNode!==e;)t=t.parentNode;return t}const jt={Control:!0,Meta:!0,Shift:!0,Alt:!0},Bt=-1!==navigator.userAgent.indexOf("Macintosh"),$t=Bt?/Cmd/:/Ctrl/;class Pt extends KeyboardEvent{constructor(e,t){super(e,t),this.shortcut=(null==t?void 0:t.shortcut)||"",this.osShortcut=`${Bt?"mac":"win"}:${this.shortcut}`,this.modShortcut=this.shortcut.replace($t,"Mod")}static fromKeyboardEvent(e){return e.shortcut=qt(e),new Pt("shortcut",e)}}function zt(e){return e.shortcut=qt(e),e.osShortcut=`${Bt?"mac":"win"}:${e.shortcut}`,e.modShortcut=e.shortcut.replace($t,"Mod"),e}function qt(e){const t=[];let n=e.key;return n?(" "===n&&(n="Space"),e.metaKey&&t.push("Cmd"),e.ctrlKey&&t.push("Ctrl"),e.altKey&&t.push("Alt"),e.shiftKey&&t.push("Shift"),jt[n]||(Bt&&e.altKey&&e.code&&e.code.startsWith("Key")&&(n=e.code.replace("Key","")),1===n.length&&(n=n.toUpperCase()),t.push(n)),t.join("+")):""}const Wt={},Kt=window.chrome&&"object"==typeof window.chrome;function Vt(e){function t(t){if(t.defaultPrevented)return;const{typeset:{lines:n},doc:r}=e;let{selection:i}=r;if(!i)return;t.preventDefault();const[s,c]=i,l=s===c,a=r.getLineAt(i[0]),[u,h]=r.getLineRange(i[0]);let d,{id:f,...p}=a.attributes;const g=n.findByAttributes(p,!0),m=c===u,y=c===h-1;!o(a)||g===n.default||g.contained||g.defaultFollows||g.frozen||!l?(s===u&&c===h&&g.frozen?(d={dontFixNewline:!0},i=0===s?[s,s]:[c,c],p=g.nextLineAttributes?g.nextLineAttributes(p):Wt):y&&(g.nextLineAttributes||g.defaultFollows||g.frozen)?p=g.nextLineAttributes?g.nextLineAttributes(p):Wt:m&&!y&&(g.defaultFollows&&(p=Wt),d={dontFixNewline:!0}),e.insert("\n",p,i,d),s===u&&c===h&&g.frozen&&e.select(0===s?0:c)):e.formatLine(Wt)}function n(t,n){if(t.defaultPrevented)return;const{typeset:{lines:r},doc:i}=e,{selection:s}=i;if(!s)return;const[c,l]=s,a=c===l,[u,h]=i.getLineRange(c);if(a&&(!Kt||t.ctrlKey||t.altKey||t.metaKey)){if(-1===n&&c!==u)return;if(1===n&&c!==h-1)return}if(t.preventDefault(),-1===n&&s[0]+s[1]===0)d(i.getLineAt(c),!0);else{const t=x(s),l=i.getLineAt(t[0]),f=r.findByAttributes(l.attributes,!0);if(a&&(-1===n&&c===u||1===n&&c===h-1)&&!f.contained){if(-1===n&&d(i.getLineAt(c)))return;const r=i.lines[i.lines.indexOf(l)+n],[s,a]=1===n?[l,r]:[r,l];if(s&&o(s)&&a&&!o(a))return e.update(e.change.delete([t[0]+n,t[0]],{dontFixNewline:!0}),Mt.input)}e.delete(n,{dontFixNewline:f.frozen})}function d(t,n){if(!t)return;const o=r.findByAttributes(t.attributes,!0);return o?o.indentable&&t.attributes.indent?(e.outdent(),!0):n||o!==r.default&&!o.defaultFollows?(e.formatLine(Wt),!0):void 0:void 0}}function r(r){var o;if(r.isComposing)return;zt(r);const i=t=>{const n=e.shortcuts[t];if(n&&e.commands[n])return r.preventDefault(),!1!==e.commands[n]()};if(!e.root.dispatchEvent(Pt.fromKeyboardEvent(r))||i(r.shortcut)||i(r.osShortcut)||i(r.modShortcut))r.preventDefault();else{switch(r.modShortcut){case"Enter":return t(r);case"Shift+Enter":return function(n){if(n.defaultPrevented)return;const{typeset:r,doc:o}=e;if(!r.embeds.get("br"))return t(n);o.selection&&(n.preventDefault(),e.insert({br:!0}))}(r);case"Tab":case"Shift+Tab":case"Mod+]":case"Mod+[":return function(t){if(t.defaultPrevented)return;t.preventDefault();const n=t.modShortcut;"Tab"===n||"Mod+]"===n?e.indent():e.outdent()}(r)}switch(null===(o=r.modShortcut)||void 0===o?void 0:o.split("+").pop()){case"Backspace":return function(e){n(e,-1)}(r);case"Delete":return function(e){n(e,1)}(r);default:return}}}function o(t){var n;return 1===t.length&&!(null===(n=e.typeset.lines.findByAttributes(t.attributes))||void 0===n?void 0:n.frozen)}return{init(){e.root.addEventListener("keydown",r)},destroy(){e.root.removeEventListener("keydown",r)}}}const Ht={dontFixNewline:!0},Xt={excludeProps:new Set(["id"])};class Zt extends Event{constructor(e,t){super(e,t),this.delta=t.delta,this.html=t.html,this.text=t.text}}function Ut(e,t){function n(n){if(!e.enabled||!e.doc.selection)return;n.preventDefault();const r=n.clipboardData,{doc:o}=e,s=o.selection&&x(o.selection);if(!r||!s)return;const[c,l]=s,a=r.getData("text/html"),u=r.getData("text/plain");let h;if(a)h=(null==t?void 0:t.htmlParser)?t.htmlParser(e,a):at(e,a,{possiblePartial:!0});else{if(!u)return;h=(new w).insert(u)}const d=h.filter((e=>"string"==typeof e.insert&&e.insert.includes("\n"))).length>0;let f=h.length();if(d){let e=F.fromDelta(h,o.byId);h=F.toDelta(e),f=h.length();const t=o.getLineAt(c),n=o.getLineAt(l),r=Jt(t),s=t===n?r:Jt(n);a||(e=e.map((e=>({...e,attributes:t.attributes}))),r!==s&&(e[e.length-1].attributes=n.attributes));const u=e[0],d=Jt(u),p=e[e.length-1],g=u===p?d:Jt(p);c===o.getLineRange(t)[0]||i(r,d,Xt)||(h=(new w).insert("\n",r).concat(h),f++);const m=h.ops[h.ops.length-1].insert,y="string"==typeof m&&m.endsWith("\n");y&&l!==o.getLineRange(n)[1]&&i(s,g,Xt)?h=h.slice(0,--f):y&&l===o.getLineRange(n)[1]-1&&(h.delete(1),f--)}const p=new Zt("paste",{delta:h,html:a,text:u,cancelable:!0});if(e.dispatchEvent(p),h=p.delta,!p.defaultPrevented)if(h&&h.ops.length){const t=e.change.delete(s,d?Ht:void 0);t.insertContent(c,h).select(c+f),e.update(t,Mt.paste)}else c!==l&&e.delete([c,l])}return{init(){e.root.addEventListener("paste",n)},destroy(){e.root.removeEventListener("paste",n)}}}function Jt(e){const{id:t,...n}=e.attributes;return n}const Qt={copyPlainText:!0,copyHTML:!0};function Yt(e,t=Qt){function n(n){if(!e.enabled||!e.doc.selection)return;n.preventDefault();const r=n.clipboardData,{doc:o}=e,{selection:i}=o;if(!o.selection)return;if(!r||!i)return;const s=x(o.selection),c=o.slice(s[0],s[1]);if(!c.ops.length)return;const l=c.map((e=>"string"==typeof e.insert?e.insert:" ")).join("");if(t.copyHTML){let t;l.includes("\n")?(c.push({insert:"\n",attributes:o.getLineFormat(s[1])}),t=st(e,new P(c))):t=ct(e,c),r.setData("text/html",t)}t.copyPlainText&&r.setData("text/plain",l)}function r(t){n(t),e.delete()}return{init(){e.root.addEventListener("copy",n),e.root.addEventListener("cut",r)},destroy(){e.root.removeEventListener("copy",n),e.root.removeEventListener("cut",r)}}}function Gt(e){function t(t){const{doc:n,old:r}=e.modules.decorations||t;r.lines!==n.lines&&Re(e,r,n)}return e.on("change",t),{render:function(t){if(t){const{doc:n,old:r}=t;r&&n?Re(e,r,n):n&&Ie(e,n)}else{const{doc:t}=e.modules.decorations||e;Ie(e,t)}},destroy(){e.off("change",t)}}}function en(e){let t,n,r=!1;function o(){if(!e.enabled)return;const t=Ft(e);if(!t&&r)return;if(r&&(r=!1),t&&t[0]===t[1]&&e.doc.selection&&e.doc.selection[0]===t[0]&&e.doc.selection[1]===t[0]+1){const n=e.doc.getLineAt(t[0]);e.typeset.lines.findByAttributes(n.attributes,!0).frozen&&(t[0]--,t[1]--)}const{doc:n}=e;if(!i(n.selection,t)){if(t&&t[0]===t[1]&&t[0]>=n.length)return;e.select(t)}}function s(){!r&&e.enabled&&Dt(e,e.doc.selection)}function c(){const{doc:t,typeset:{lines:n}}=e,r=e.modules.decorations.getDecorator("selection");r.clear();const o=t.selection;o&&t.getLinesAt(o).forEach((e=>{if(n.findByAttributes(e.attributes,!0).frozen){const n=i(o,t.getLineRange(e));r.decorateLine(t.getLineRange(e)[0],{class:"selected"+(n?" focus":"")})}})),r.apply()}function l(t){let n=t.target;for(;n.parentNode&&n.parentNode!==e.root;)n=n.parentNode;const r=Se(e.root,n),o=null!=r&&e.doc.getLineAt(r),i=o&&e.typeset.lines.findByAttributes(o.attributes);null!=r&&o&&i&&i.frozen&&(t.preventDefault(),e.select([r,r+o.length]))}function a(t){var n;const r=(null===(n=t.doc)||void 0===n?void 0:n.selection)||e.doc.selection;Dt(e,r)}function u(){e.root.classList.toggle("window-inactive",!t.hasFocus())}return{pause:function(){r=!0;const{selection:t}=e.doc,{decorations:n}=e.modules;t&&t[0]!==t[1]&&n&&n.getDecorator("pausedSelection").decorateText(t,{class:"selected"}).apply()},resume:function(){r=!1;const{decorations:t}=e.modules;t&&t.removeDecorations("pausedSelection"),setTimeout(s)},renderSelection:s,init(){t=e.root.ownerDocument,n=t.defaultView,t.addEventListener("selectionchange",o),n.addEventListener("focus",u),n.addEventListener("blur",u),e.root.addEventListener("mousedown",l),e.on("change",a),e.on("decorate",c)},destroy(){t.removeEventListener("selectionchange",o),n.removeEventListener("focus",u),n.removeEventListener("blur",u),e.root.removeEventListener("mousedown",l),e.off("change",a),e.off("decorate",c),r=!1,t=null,n=null}}}function tn(e,t){return n=>{function r({doc:r}){var o,s,c;const l=n.modules.decorations.getDecorator("placeholder"),a=("function"==typeof e?e():e)||"";let u;if(l.hasDecorations()){const e=l.getDecoration().ops;u=null===(s=null===(o=e[e.length-1].attributes)||void 0===o?void 0:o.decoration)||void 0===s?void 0:s.placeholder}const{lines:h}=n.typeset,d=h.findByAttributes(null===(c=r.lines[0])||void 0===c?void 0:c.attributes,!0),f=h.default===d&&1===r.length;if(f||(null==t?void 0:t.keepAttribute)){const e={"data-placeholder":a||""};f&&(e.class="placeholder"),i(e,u)||(l.remove(),l.decorateLine(0,e).apply())}else l.remove()}return n.addEventListener("decorate",r),{destroy(){n.removeEventListener("decorate",r)}}}}const nn=/['"]/g,rn=/[\s\{\[\(\<'"\u2018\u201C]/,on={'"':{left:"“",right:"”"},"'":{left:"‘",right:"’"}};function sn(e){function t(e){const{change:t,source:n,doc:r,old:o}=e;if("api"===n||!o.selection||!t)return;const i=function(e){const t=[];let n=0;return e.forEach((e=>{if(e.retain)n+=e.retain;else if("string"==typeof e.insert){let r;for(;r=nn.exec(e.insert);)t.push([n+r.index,e.attributes]);n+=e.insert.length}else e.insert&&(n+=1)})),t}(t.delta.ops);if(!i.length)return;const s=r.getText(),c=new w;let l=0;for(let e=0;e<i.length;e++){const[t,n]=i[e],r=s[t],o=!t||rn.test(s[t-1])?on[r].left:on[r].right;c.retain(t-l).delete(1).insert(o,n),l=t+1}e.modify(c)}return e.on("changing",t),{destroy(){e.off("changing",t)}}}const cn=[[/^(#{1,6}) $/,e=>({header:e.length})],[/^[-*] $/,()=>({list:"bullet"})],[/^1\. $/,()=>({list:"ordered"})],[/^([AaIi])\. $/,e=>({list:"ordered",type:e})],[/^(-?\d+)\. $/,e=>({list:"ordered",start:e})],[/^([A-Z])\. $/,e=>({list:"ordered",type:"A",start:e.charCodeAt(0)-"A".charCodeAt(0)+1})],[/^([a-z])\. $/,e=>({list:"ordered",type:"a",start:e.charCodeAt(0)-"a".charCodeAt(0)+1})],[/^([IVXLCDM]+)\. $/i,e=>({list:"ordered",type:e[0].toUpperCase()===e[0]?"I":"i",start:fn(e)})],[/^> $/,()=>({blockquote:!0})]],ln=[[/(https?:\/\/.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_+.~#?&/=]*\s$/s,e=>({link:e})],[/(www\.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_+.~#?&/=]*\s$/s,e=>({link:"https://"+e})],[/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.(com|org|net|io)\b[-a-zA-Z0-9@:%_+.~#?&/=]*\s$/s,e=>({link:"https://"+e})]],an=[[/--$/,()=>"—"],[/\.\.\.$/,()=>"…"]],un=[function(e,t,n){return cn.some((([r,o])=>{const i=n.match(r);if(i){const r=o(i[1]);if(!e.typeset.lines.findByAttributes(r))return!1;const s=t-n.length,c=e.change.delete([s,t]).formatLine(t,r).select([s,s]);return e.update(c),!0}return!1}))},function(e,t,n){return an.some((([r,o])=>{const i=n.match(r);return!!i&&(e.insert(o(i[1]),void 0,[t-i[0].length,t]),!0)}))},function(e,t,n){return ln.some((([r,o])=>{const i=n.match(r);if(i){let n=i[0].slice(0,-1);"."===n[n.length-1]&&(n=n.slice(0,-1));const r=t-(i[0].length-n.length),s=o(n);return!!e.typeset.formats.findByAttributes(s)&&(e.formatText(s,[r-n.length,r]),!0)}return!1}))}];function hn(e=un){return t=>{let n=!1;function r({change:r,source:o}){if(n||"api"===o||!t.doc.selection||!r||!function(e){return(1===e.ops.length||2===e.ops.length&&e.ops[0].retain&&!e.ops[0].attributes)&&e.ops[e.ops.length-1].insert}(r.delta))return;const i=t.doc.selection[1],s=t.doc.getText(),c=s.lastIndexOf("\n",i-2)+1,l=s.slice(c,i);n=!0,e.some((e=>e(t,i,l,s))),n=!1}return t.on("changed",r),{destroy(){t.off("changed",r)}}}}const dn={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};function fn(e){e=e.toUpperCase();let t=0;for(let n=0;n<e.length;n++){const r=dn[e[n]],o=dn[e[n+1]];if(void 0===r)return;r<o?(t+=o-r,n++):t+=r}return t}const pn={keyboard:Vt,input:It,copy:Yt,paste:Ut,history:Ot,decorations:Ee,rendering:Gt,selection:en};function gn(){}function mn(e){return e()}function yn(e){e.forEach(mn)}function bn(e){return"function"==typeof e}function vn(e,...t){if(null==e)return gn;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Ln(e){let t;return vn(e,(e=>t=e))(),t}let En;new Set,new Set,Promise.resolve(),new Set,new Set,"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(En=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(mn).filter(bn);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){yn(this.$$.on_disconnect)}$destroy(){(function(e,t){const n=e.$$;null!==n.fragment&&(yn(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])})(this,1),this.$destroy=gn}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});const wn=[];function xn(e,t){return{subscribe:kn(e,t).subscribe}}function kn(e,t=gn){let n;const r=[];function o(t){if(i=t,((o=e)!=o?i==i:o!==i||o&&"object"==typeof o||"function"==typeof o)&&(e=t,n)){const t=!wn.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),wn.push(n,e)}if(t){for(let e=0;e<wn.length;e+=2)wn[e][0](wn[e+1]);wn.length=0}}var o,i}return{set:o,update:function(t){o(t(e))},subscribe:function(i,s=gn){const c=[i,s];return r.push(c),1===r.length&&(n=t(o)||gn),i(e),()=>{const e=r.indexOf(c);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}const Nn=()=>{},An=xn({},Nn),Tn=xn(new P,Nn),Fn=xn(null,Nn),Dn=xn(void 0,Nn);function Mn(e){const t=Rn(On(e)),n=Rn(Sn(e)),r=Rn(_n(e)),o=Rn(In(e)),i=Cn(r);return{active:t,doc:n,selection:r,root:o,focus:i,updateEditor:function(i){i!==e&&(e=i,t.set(On(e)),n.set(Sn(e)),r.set(_n(e)),o.set(In(e)))}}}function On(e){if(!e)return An;let t=e.getActive();return xn(t,(n=>{const r=()=>{const r=e.getActive();i(t,r)||n(t=r)};return e.on("changed",r),e.on("format",r),()=>{e.off("changed",r),e.off("format",r)}}))}function Sn(e){return e?xn(e.doc,(t=>{const n=()=>t(e.doc);return n(),e.on("changed",n),()=>e.off("changed",n)})):Tn}function _n(e){return e?xn(e.doc.selection,(t=>{const n=()=>t(e.doc.selection);return n(),e.on("changed",n),()=>e.off("changed",n)})):Fn}function Cn(e){return function(e,t,n){const r=!Array.isArray(e),o=r?[e]:e,i=t.length<2;return xn(void 0,(e=>{let n=!1;const s=[];let c=0,l=gn;const a=()=>{if(c)return;l();const n=t(r?s[0]:s);i?e(n):l=bn(n)?n:gn},u=o.map(((e,t)=>vn(e,(e=>{s[t]=e,c&=~(1<<t),n&&a()}),(()=>{c|=1<<t}))));return n=!0,a(),function(){yn(u),l()}}))}(e,(e=>!!e))}function In(e){return e?xn(e._root,(t=>{const n=()=>t(e._root);return n(),e.on("root",n),()=>e.off("root",n)})):Dn}function Rn(e){const t="subscribe"in e?Ln(e):e,{set:n,subscribe:r}=kn(t);let o;function i(e){o&&o(),e&&(o=e.subscribe((e=>n(e))))}return"subscribe"in e&&i(e),{set:i,subscribe:r}}fe({name:"paragraph",selector:"p",commands:e=>()=>e.formatLine({}),shortcuts:"Mod+0",render:(e,t)=>oe("p",null,t)}),fe({name:"header",selector:"h1, h2, h3, h4, h5, h6",defaultFollows:!0,commands:e=>({header:t=>e.toggleLineFormat({header:t}),header1:()=>e.toggleLineFormat({header:1}),header2:()=>e.toggleLineFormat({header:2}),header3:()=>e.toggleLineFormat({header:3}),header4:()=>e.toggleLineFormat({header:4}),header5:()=>e.toggleLineFormat({header:5}),header6:()=>e.toggleLineFormat({header:6})}),shortcuts:{"Mod+1":"header1","Mod+2":"header2","Mod+3":"header3","Mod+4":"header4","Mod+5":"header5","Mod+6":"header6"},fromDom:e=>({header:parseInt(e.nodeName.replace("H",""))}),render:(e,t)=>oe(`h${e.header}`,null,t)}),fe({name:"list",selector:"ul > li, ol > li",indentable:!0,commands:e=>({bulletList:()=>e.toggleLineFormat({list:"bullet"}),orderedList:()=>e.toggleLineFormat({list:"ordered"}),checkList:()=>e.toggleLineFormat({list:"check"}),indent:()=>e.indent(),outdent:()=>e.outdent(),toggleCheck:t=>{const n="string"==typeof t?e.doc.getLineBy(t):e.doc.selection?e.doc.getLineAt(e.doc.selection[0]):null;if(!n)return!1;const[r]=e.doc.getLineRange(n),o={list:"check"};n.attributes.checked||(o.checked=!0),e.formatLine(o,r)}}),shortcuts:{"Mod+Space":"toggleCheck"},fromDom(e){let t=-1,n=e.parentNode;const r=e.hasAttribute("data-checked")?"check":n&&"OL"===n.nodeName?"ordered":"bullet";for(;n;){if(/^UL|OL$/.test(n.nodeName))t++;else if("LI"!==n.nodeName)break;n=n.parentNode}!t&&e.className.startsWith("ql-indent-")&&(t=parseInt(e.className.replace("ql-indent-","")));const o={list:r};return t&&(o.indent=t),"true"===e.getAttribute("data-checked")&&(o.checked=!0),o},nextLineAttributes(e){const{start:t,...n}=e;return n},shouldCombine:(e,t)=>e.list===t.list||t.indent,renderMultiple:(e,t,n)=>{const r=[],o=[];return e.forEach((([e,i,s])=>{const c="ordered"===e.list?"ol":"ul",l=e.indent||0;let a={key:s};if("check"===e.list){function u(e){t.enabled&&(e.preventDefault(),t.commands.toggleCheck(s))}const n=oe("button",{class:"check-list-check",onmousedown:u,ontouchstart:u});1===i.length&&"br"===i[0].type?i.push(n):i.unshift(n),a={...a,class:"check-list-item","data-checked":""+(e.checked||!1)}}const h=xe(oe("li",a,i),e);for(;l>=o.length;){const t=oe(c,{start:e.start,type:e.type,key:`${s}-outer`}),i=o.length?o[o.length-1].children:r,l=i[i.length-1];"object"==typeof l&&"li"===l.type&&n?l.children.push(t):i.push(t),o.push(t)}if(!function(e,t,n){return e.type===t&&(e.props.start===n.start||e.props.start&&!n.start)&&e.props.type===n.type}(o[l],c,e)){const t=oe(c,{start:e.start,type:e.type});(l?o[l-1].children:r).push(t),o[l]=t}o[l].children.push(h),o.length=l+1})),r[0]}}),fe({name:"blockquote",selector:"blockquote p",commands:e=>(t=!0)=>{"string"!=typeof t&&(t=!0),e.toggleLineFormat({blockquote:t})},fromDom(e){const{className:t}=e.parentNode,n=t.match(/quote-(\S+)/);return{blockquote:n&&"true"!==n[1]&&n[1]||!0}},shouldCombine:(e,t)=>e.blockquote===t.blockquote,renderMultiple:e=>{const t=e[0][0].blockquote,n="string"==typeof t?{className:`quote-${t}`}:null,r=e.map((([e,t,n])=>oe("p",{key:n},t)));return oe("blockquote",n,r)}}),fe({name:"code-block",selector:"pre code",contained:!0,commands:e=>()=>e.toggleLineFormat({"code-block":!0}),renderMultiple:e=>{const t=[];return e.forEach((([e,n,r])=>{n.length&&"br"===n[n.length-1].type&&n.pop(),t.push(oe("code",{key:r},n)),t.push("\n")})),oe("pre",{spellcheck:!1},t)}}),fe({name:"hr",selector:"hr",frozen:!0,commands:e=>()=>{const{doc:t}=e,{selection:n}=t;if(!n)return;const r=x(n),o=e.change.delete(r);if(r[0]===r[1]&&1===t.getLineAt(r[0]).length)o.insert(r[0],"\n",{...t.getLineFormat(r[0])}).formatLine(r[0],{hr:!0});else{const e=(new w).insert("\n",t.getLineAt(r[0]).attributes).insert("\n",{hr:!0});o.insertContent(r[0],e),o.select(r[0]+2)}e.update(o)},render:()=>oe("hr")}),pe({name:"bold",selector:"strong, b",styleSelector:'[style*="font-weight:bold"], [style*="font-weight: bold"]',commands:e=>()=>e.toggleTextFormat({bold:!0}),shortcuts:"Mod+B",render:(e,t)=>oe("strong",null,t)}),pe({name:"italic",selector:"em, i",styleSelector:'[style*="font-style:italic"], [style*="font-style: italic"]',commands:e=>()=>e.toggleTextFormat({italic:!0}),shortcuts:"Mod+I",render:(e,t)=>oe("em",null,t)}),pe({name:"code",selector:"code",commands:e=>()=>e.toggleTextFormat({code:!0}),render:(e,t)=>oe("code",null,t)}),pe({name:"link",selector:"a[href]",greedy:!1,commands:e=>t=>e.toggleTextFormat({link:t}),fromDom:e=>e.href,render:(e,t)=>oe("a",{href:e.link,target:"_blank"},t)}),ge({name:"image",selector:"img",commands:e=>(t,n)=>e.insert({image:t,...n}),fromDom:e=>{const t={};return["src","alt","width","height"].forEach((n=>{if(!e.hasAttribute(n))return;const r=e.getAttribute(n);"src"===n&&(n="image"),t[n]=r})),t},render:e=>{const{image:t,...n}=e;return n.src=t,oe("img",n)}}),ge({name:"br",selector:"br",commands:e=>()=>e.insert({br:!0}),render:()=>oe("br")});const jn={lines:["paragraph","header","list","blockquote","code-block","hr"],formats:["link","bold","italic","code"],embeds:["image","br"]},Bn={},$n=[],Pn=["focus","blur","keydown","mousedown","mouseup","click"],zn=new WeakMap;class qn extends Event{constructor(e,t){super(e,t),this.old=t.old,this.doc=t.doc,this.change=t.change,this.changedLines=t.changedLines,this.source=t.source,Object.setPrototypeOf(this,qn.prototype)}modify(e){if(!this.cancelable)throw new Error('Cannot modify an applied change, listen to the "changing" event');this.doc=this.doc.apply(e),this.change&&(this.change.delta=this.change.delta.compose(e)),this.changedLines&&(this.changedLines=this.old.lines===this.doc.lines?$n:Xn(this.old,this.doc))}}class Wn extends Event{constructor(e,t){super(e,t),this.formats=t.formats}}class Kn extends h{constructor(e={}){super(),this.activeFormats=Bn,this.commands={},this.shortcuts={},this.modules={},this.catchErrors=!e.dev,this.identifier=e.identifier,this.typeset=new de(e.types||jn),e.doc?this.doc=e.doc:e.html?this.doc=lt(this,e.html):e.text?this.doc=new P((new w).insert(e.text)):this.doc=new P,this.throwOnError=e.throwOnError||!1,this._enabled=void 0===e.enabled||e.enabled,this._modules={...pn,...e.modules},e.root&&this.setRoot(e.root)}get root(){return this._root||this.setRoot(document.createElement("div")),this._root}get enabled(){return this._enabled}set enabled(e){e=!!e;const t=this._enabled!==e;!e&&this.doc.selection&&this.select(null,Mt.api),this._enabled=e,this._root&&(this._root.contentEditable=e?"true":"inherit"),t&&this.dispatchEvent(new Event("enabledchange"))}get change(){const e=new C(this.doc);return e.apply=(t=Mt.user)=>this.update(e,t),e}setRoot(e){if(!e)throw new TypeError("Root must be set, cannot be "+e);return this.destroy(),this._root=e,this.init(),this.dispatchEvent(new Event("root")),this}update(e,t=Mt.user){if(!this.enabled&&t!==Mt.api)return this;e instanceof w&&(e=new C(this.doc,e));const n=this.doc,r=n.apply(e,void 0,this.throwOnError),o=n.lines===r.lines?$n:Xn(n,r);return this.set(r,t,e,o),this}set(e,t=Mt.user,n,r){const o=this.doc;if(e instanceof w&&(e=new P(e)),!this.enabled&&t!==Mt.api||!e||o.equals(e))return this;const i=new qn("changing",{cancelable:!0,old:o,doc:e,change:n,changedLines:r,source:t});return this.dispatchEvent(i,this.catchErrors),i.defaultPrevented||o.equals(i.doc)||(this.activeFormats=(null==n?void 0:n.activeFormats)?n.activeFormats:Hn(this,i.doc),this.doc=i.doc,this.dispatchEvent(new qn("change",{...i,cancelable:!1}),this.catchErrors),this.dispatchEvent(new qn("changed",{...i,cancelable:!1}),this.catchErrors)),this}getHTML(){return st(this,this.doc)}setHTML(e,t=this.doc.selection,n){return this.set(lt(this,e,t))}getDelta(){return this.doc.toDelta()}setDelta(e,t=this.doc.selection,n){return this.set(new P(e,t),n)}getText(e){return this.doc.getText(e)}setText(e,t=this.doc.selection,n){return this.set(new P((new w).insert(e),t),n)}getActive(){const{selection:e}=this.doc;let t=e?e[0]===e[1]?{...this.activeFormats,...this.doc.getLineFormat(e)}:{...this.doc.getFormats(e)}:{};return Object.values(this.modules).forEach((e=>{e.getActive&&(t={...t,...e.getActive()})})),t}select(e,t){return this.update(this.change.select(e),t)}insert(e,t,n=this.doc.selection,r){if(!n)return this;const o=i(n,this.doc.selection);null==t&&"string"==typeof e&&"\n"!==e&&(t=o?this.activeFormats:Hn(this,this.doc,n));const s=this.typeset.lines.findByAttributes(t,!0),c=this.change.delete(n),l=x(n)[0];if(o&&c.setActiveFormats("\n"!==e&&t||Hn(this,this.doc,n)),"\n"===e&&s.frozen){const e={...this.doc.getLineFormat(l)},n={...t};let r={...e};const o=(new w).insert("\n",e);this.doc.getLineRange(l)[1]-1!==l?o.insert("\n",n):r=n,c.insertContent(l,o).formatLine(l,r).select(l+2)}else c.insert(l,e,t,r);return this.update(c)}insertContent(e,t=this.doc.selection){if(!t)return this;const n=this.change.delete(t).insertContent(t[0],e);return this.update(n)}delete(e,t){let n;if(Array.isArray(e))n=x(e);else{if(!this.doc.selection)return this;n=x(this.doc.selection),e&&n[0]===n[1]&&(n=e<0?[n[0]+e,n[1]]:[n[0],n[1]+e])}const r=Hn(this,this.doc,n),o=this.change.delete(n,t).select(n[0]).setActiveFormats(r);return this.update(o)}formatText(e,t=this.doc.selection){return t?("string"==typeof e&&(e={[e]:!0}),t[0]===t[1]?(this.activeFormats=m.compose(this.activeFormats,e)||Bn,this.dispatchEvent(new Wn("format",{formats:this.activeFormats})),this):(Vn(this,"formatText",e,t),this)):this}toggleTextFormat(e,t=this.doc.selection){return t?("string"==typeof e&&(e={[e]:!0}),t[0]===t[1]?(I(e,this.activeFormats)&&(e=m.invert(e)),this.activeFormats=m.compose(this.activeFormats,e)||Bn,this.dispatchEvent(new Wn("format",{formats:this.activeFormats})),this):(Vn(this,"toggleTextFormat",e,t),this)):this}formatLine(e,t=this.doc.selection){return"string"==typeof e&&(e={[e]:!0}),Vn(this,"formatLine",e,t),this}toggleLineFormat(e,t=this.doc.selection){return"string"==typeof e&&(e={[e]:!0}),Vn(this,"toggleLineFormat",e,t),this}indent(){return Jn(this,1),this}outdent(){return Jn(this,-1),this}removeFormat(e=this.doc.selection){return Vn(this,"removeFormat",null,e),this}getBounds(e,t,n){var r;if("number"==typeof e&&(e=[e,e]),!e)return;let o=null===(r=Lt(this,e))||void 0===r?void 0:r.getBoundingClientRect();if(o&&t){const e=t.getBoundingClientRect(),r=(n?t.scrollLeft:0)-e.x,i=(n?t.scrollTop:0)-e.y;o=new DOMRect(o.x+r,o.y+i,o.width,o.height)}return o}getAllBounds(e,t,n){var r;"number"==typeof e&&(e=[e,e]);const o=null===(r=Lt(this,e))||void 0===r?void 0:r.getClientRects();let i=o&&Array.from(o);if(i&&t){const e=t.getBoundingClientRect(),r=(n?t.scrollLeft:0)-e.x,o=(n?t.scrollTop:0)-e.y;i=i.map((e=>new DOMRect(e.x+r,e.y+o,e.width,e.height)))}return i}getIndexFromPoint(e,t){return yt(this,e,t)}render(){var e,t,n;return null===(e=this.modules.decorations)||void 0===e||e.gatherDecorations(),null===(t=this.modules.rendering)||void 0===t||t.render(),null===(n=this.modules.selection)||void 0===n||n.renderSelection(),this}init(){const e=this._root;e.editor&&e.editor.destroy(),e.editor=this,this.enabled=this._enabled,this.commands={},Pn.forEach((e=>this._root.addEventListener(e,Qn(this)))),this.typeset.lines.list.forEach((e=>e.commands&&Zn(this,e.name,e.commands(this)))),this.typeset.formats.list.forEach((e=>e.commands&&Zn(this,e.name,e.commands(this)))),this.typeset.embeds.list.forEach((e=>e.commands&&Zn(this,e.name,e.commands(this)))),Object.keys(this._modules).forEach((e=>{if(!this._modules[e])return;const t=this.modules[e]=this._modules[e](this);t.commands&&Zn(this,e,t.commands)})),this.shortcuts=function(e){const t={},{typeset:{lines:n,formats:r,embeds:o},modules:i}=e;return Gn(n,t),Gn(r,t),Gn(o,t),function(e,t){Object.keys(e).forEach((n=>{var r;const o=null===(r=e[n])||void 0===r?void 0:r.shortcuts;o&&er(o,t)}))}(i,t),t}(this),Object.keys(this.modules).forEach((e=>{var t,n;return null===(n=(t=this.modules[e]).init)||void 0===n?void 0:n.call(t)})),this.render()}destroy(){const e=this._root;e&&(Pn.forEach((t=>e.removeEventListener(t,Qn(this)))),Object.values(this.modules).forEach((e=>e.destroy&&e.destroy())),this._root=void 0,delete e.editor)}}function Vn(e,t,n,r){if(!r)return;const o=e.change[t](r,n);e.update(o)}function Hn(e,t,n=t.selection){const{formats:r}=e.typeset;if(!n||0===n[0])return Bn;const o=x(n)[0];let i=o;const s=t.getTextFormat(i),c={};return Object.keys(s).forEach((e=>{const n=r.get(e);n&&(!1!==n.greedy||t.getTextFormat(o)[e])&&(c[e]=s[e])})),c}function Xn(e,t){const n=new Set(e.lines);return t.lines.filter((e=>!n.has(e)))}function Zn(e,t,n){n&&("function"==typeof n?e.commands[t]=Un(e,n):Object.keys(n).forEach((t=>e.commands[t]=Un(e,n[t]))))}function Un(e,t){return(...n)=>{t(...n),e.doc.selection&&e.root.focus()}}function Jn(e,t=1){const{typeset:{lines:n},doc:r}=e,{selection:o}=r;if(!o)return r;const i=e.change;r.getLinesAt(o).forEach((e=>{if(!n.findByAttributes(e.attributes,!0).indentable)return;const o=r.getLineRange(e);let s=(e.attributes.indent||0)+t;s<=0&&(s=null),i.formatLine(o[0],s<0?Bn:{...e.attributes,indent:s})})),e.update(i)}function Qn(e){let t=zn.get(e);return t||(t=Yn.bind(e),zn.set(e,t)),t}function Yn(e){this.dispatchEvent(e)}function Gn(e,t){e.list.forEach((e=>{const n=e.shortcuts;n&&("string"==typeof n?t[n]=e.name:er(n,t))}))}function er(e,t){Object.keys(e).forEach((n=>t[n]=e[n]))}})(),typewriter=r})();
//# sourceMappingURL=bundle.js.map